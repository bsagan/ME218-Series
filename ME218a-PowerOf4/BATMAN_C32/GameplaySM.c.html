<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<title>GameplaySM.c</title>
<link rel="stylesheet" type="text/css" href="highlight.css">
</head>
<body class="hl">
<pre class="hl"><a name="GameplaySM.c_1"></a><span class="hl lin">    1 </span><span class="hl com">/****************************************************************************</span>
<a name="GameplaySM.c_2"></a><span class="hl lin">    2 </span><span class="hl com"> Module</span>
<a name="GameplaySM.c_3"></a><span class="hl lin">    3 </span><span class="hl com">   GameplaySM.c</span>
<a name="GameplaySM.c_4"></a><span class="hl lin">    4 </span><span class="hl com"></span>
<a name="GameplaySM.c_5"></a><span class="hl lin">    5 </span><span class="hl com"> Revision</span>
<a name="GameplaySM.c_6"></a><span class="hl lin">    6 </span><span class="hl com">   1.0.1</span>
<a name="GameplaySM.c_7"></a><span class="hl lin">    7 </span><span class="hl com"></span>
<a name="GameplaySM.c_8"></a><span class="hl lin">    8 </span><span class="hl com"> Description</span>
<a name="GameplaySM.c_9"></a><span class="hl lin">    9 </span><span class="hl com">   This is a Gameplay file for implementing flat state machines under the</span>
<a name="GameplaySM.c_10"></a><span class="hl lin">   10 </span><span class="hl com">   Gen2 Events and Services Framework.</span>
<a name="GameplaySM.c_11"></a><span class="hl lin">   11 </span><span class="hl com"></span>
<a name="GameplaySM.c_12"></a><span class="hl lin">   12 </span><span class="hl com"> Notes</span>
<a name="GameplaySM.c_13"></a><span class="hl lin">   13 </span><span class="hl com"></span>
<a name="GameplaySM.c_14"></a><span class="hl lin">   14 </span><span class="hl com">****************************************************************************/</span>
<a name="GameplaySM.c_15"></a><span class="hl lin">   15 </span><span class="hl com">/*----------------------------- Include Files -----------------------------*/</span>
<a name="GameplaySM.c_16"></a><span class="hl lin">   16 </span><span class="hl com">/* include header files for this state machine as well as any machines at the</span>
<a name="GameplaySM.c_17"></a><span class="hl lin">   17 </span><span class="hl com">   next lower level in the hierarchy that are sub-machines to this machine</span>
<a name="GameplaySM.c_18"></a><span class="hl lin">   18 </span><span class="hl com">*/</span>
<a name="GameplaySM.c_19"></a><span class="hl lin">   19 </span><span class="hl ppc">#include</span> <span class="hl pps">&quot;ES_Configure.h&quot;</span><span class="hl ppc"></span>
<a name="GameplaySM.c_20"></a><span class="hl lin">   20 </span><span class="hl ppc">#include</span> <span class="hl pps">&quot;ES_Framework.h&quot;</span><span class="hl ppc"></span>
<a name="GameplaySM.c_21"></a><span class="hl lin">   21 </span><span class="hl ppc">#include</span> <span class="hl pps">&quot;ES_General.h&quot;</span><span class="hl ppc"></span>
<a name="GameplaySM.c_22"></a><span class="hl lin">   22 </span><span class="hl ppc">#include</span> <span class="hl pps">&quot;ES_Events.h&quot;</span><span class="hl ppc"></span>
<a name="GameplaySM.c_23"></a><span class="hl lin">   23 </span><span class="hl ppc">#include</span> <span class="hl pps">&quot;ES_PostList.h&quot;</span><span class="hl ppc"></span>
<a name="GameplaySM.c_24"></a><span class="hl lin">   24 </span><span class="hl ppc">#include</span> <span class="hl pps">&quot;EventCheckers.h&quot;</span><span class="hl ppc"></span>
<a name="GameplaySM.c_25"></a><span class="hl lin">   25 </span><span class="hl ppc">#include</span> <span class="hl pps">&quot;ES_Timers.h&quot;</span><span class="hl ppc"></span>
<a name="GameplaySM.c_26"></a><span class="hl lin">   26 </span><span class="hl ppc">#include &lt;ME218_C32.h&gt;</span>
<a name="GameplaySM.c_27"></a><span class="hl lin">   27 </span><span class="hl ppc">#include &lt;stdio.h&gt;</span>
<a name="GameplaySM.c_28"></a><span class="hl lin">   28 </span><span class="hl ppc">#include &lt;string.h&gt;</span>
<a name="GameplaySM.c_29"></a><span class="hl lin">   29 </span><span class="hl ppc">#include</span> <span class="hl pps">&quot;ADS12.H&quot;</span><span class="hl ppc"></span>
<a name="GameplaySM.c_30"></a><span class="hl lin">   30 </span><span class="hl ppc">#include</span> <span class="hl pps">&quot;PWMS12.h&quot;</span><span class="hl ppc"></span>
<a name="GameplaySM.c_31"></a><span class="hl lin">   31 </span>
<a name="GameplaySM.c_32"></a><span class="hl lin">   32 </span><span class="hl ppc">#include</span> <span class="hl pps">&quot;PortSampleSM.h&quot;</span><span class="hl ppc"></span>
<a name="GameplaySM.c_33"></a><span class="hl lin">   33 </span><span class="hl ppc">#include</span> <span class="hl pps">&quot;MotorSM.h&quot;</span><span class="hl ppc"></span>
<a name="GameplaySM.c_34"></a><span class="hl lin">   34 </span><span class="hl ppc">#include</span> <span class="hl pps">&quot;BatMorseSM.h&quot;</span><span class="hl ppc"></span>
<a name="GameplaySM.c_35"></a><span class="hl lin">   35 </span><span class="hl ppc">#include</span> <span class="hl pps">&quot;ComSM.h&quot;</span><span class="hl ppc"></span>
<a name="GameplaySM.c_36"></a><span class="hl lin">   36 </span><span class="hl ppc">#include</span> <span class="hl pps">&quot;GameplaySM.h&quot;</span><span class="hl ppc"></span>
<a name="GameplaySM.c_37"></a><span class="hl lin">   37 </span><span class="hl ppc">#include</span> <span class="hl pps">&quot;Lighting.h&quot;</span><span class="hl ppc"></span>
<a name="GameplaySM.c_38"></a><span class="hl lin">   38 </span>
<a name="GameplaySM.c_39"></a><span class="hl lin">   39 </span><span class="hl com">/*----------------------------- Module Defines ----------------------------*/</span>
<a name="GameplaySM.c_40"></a><span class="hl lin">   40 </span>
<a name="GameplaySM.c_41"></a><span class="hl lin">   41 </span><span class="hl com">/*---------------------------- Module Functions ---------------------------*/</span>
<a name="GameplaySM.c_42"></a><span class="hl lin">   42 </span><span class="hl com">/* prototypes for private functions for this machine.They should be functions</span>
<a name="GameplaySM.c_43"></a><span class="hl lin">   43 </span><span class="hl com">   relevant to the behavior of this state machine</span>
<a name="GameplaySM.c_44"></a><span class="hl lin">   44 </span><span class="hl com">*/</span>
<a name="GameplaySM.c_45"></a><span class="hl lin">   45 </span>
<a name="GameplaySM.c_46"></a><span class="hl lin">   46 </span><span class="hl kwb">static void</span> <span class="hl kwd">GenerateNewAction</span><span class="hl opt">(</span> <span class="hl kwb">void</span> <span class="hl opt">);</span> <span class="hl slc">// Private Function Required to prompt user</span>
<a name="GameplaySM.c_47"></a><span class="hl lin">   47 </span><span class="hl kwb">static void</span> <span class="hl kwd">EvalAction</span><span class="hl opt">(</span> ES_Event Action <span class="hl opt">);</span>  <span class="hl slc">// Private Function to evaluate a user's response</span>
<a name="GameplaySM.c_48"></a><span class="hl lin">   48 </span><span class="hl kwb">static void</span> <span class="hl kwd">EvalOilAction</span> <span class="hl opt">(</span> ES_Event OilAction<span class="hl opt">);</span> <span class="hl slc">//Private Function to eval oilbuttonpress</span>
<a name="GameplaySM.c_49"></a><span class="hl lin">   49 </span><span class="hl kwb">static void</span> <span class="hl kwd">EvalGameEnd</span><span class="hl opt">(</span> <span class="hl kwb">void</span><span class="hl opt">);</span>  <span class="hl slc">// Private Function to evaluate who wins</span>
<a name="GameplaySM.c_50"></a><span class="hl lin">   50 </span><span class="hl kwb">static void</span> <span class="hl kwd">ChangeResponseTime</span><span class="hl opt">(</span> <span class="hl kwb">int</span> NextTimeVal <span class="hl opt">);</span> <span class="hl slc">// Changes response timer val</span>
<a name="GameplaySM.c_51"></a><span class="hl lin">   51 </span><span class="hl kwb">static void</span> <span class="hl kwd">ChangeAction</span><span class="hl opt">(</span> <span class="hl kwb">void</span> <span class="hl opt">);</span> <span class="hl slc">//Changes user input prompted</span>
<a name="GameplaySM.c_52"></a><span class="hl lin">   52 </span>
<a name="GameplaySM.c_53"></a><span class="hl lin">   53 </span><span class="hl com">/*---------------------------- Module Variables ---------------------------*/</span>
<a name="GameplaySM.c_54"></a><span class="hl lin">   54 </span><span class="hl slc">// everybody needs a state variable, you may need others as well.</span>
<a name="GameplaySM.c_55"></a><span class="hl lin">   55 </span><span class="hl slc">// type of state variable should match htat of enum in header file</span>
<a name="GameplaySM.c_56"></a><span class="hl lin">   56 </span><span class="hl kwb">static</span> GameplayState_t CurrentState<span class="hl opt">;</span>
<a name="GameplaySM.c_57"></a><span class="hl lin">   57 </span><span class="hl kwb">static char</span> CurrentAction<span class="hl opt">;</span> <span class="hl slc">// Stores the prompted action to the user</span>
<a name="GameplaySM.c_58"></a><span class="hl lin">   58 </span><span class="hl kwb">static char</span> OilPrompt <span class="hl opt">=</span> OFF<span class="hl opt">;</span>  <span class="hl slc">// Stores if the user is prompted for oil button</span>
<a name="GameplaySM.c_59"></a><span class="hl lin">   59 </span><span class="hl kwb">static char</span> NextAction <span class="hl opt">=</span> LASER_ACTION<span class="hl opt">;</span> <span class="hl slc">// Stores the next action to generate</span>
<a name="GameplaySM.c_60"></a><span class="hl lin">   60 </span><span class="hl kwb">static int</span> ResponseTime <span class="hl opt">=</span> RESPONSE_TIME0<span class="hl opt">;</span> <span class="hl slc">// Stores the value of the Response Timer</span>
<a name="GameplaySM.c_61"></a><span class="hl lin">   61 </span><span class="hl kwb">static int</span> i<span class="hl opt">;</span>
<a name="GameplaySM.c_62"></a><span class="hl lin">   62 </span><span class="hl kwb">static char</span> PedalTimer <span class="hl opt">=</span> OFF<span class="hl opt">;</span><span class="hl slc">//Declare static variable needed to track timer pedal timer state</span>
<a name="GameplaySM.c_63"></a><span class="hl lin">   63 </span>
<a name="GameplaySM.c_64"></a><span class="hl lin">   64 </span><span class="hl slc">// with the introduction of Gen2, we need a module level Priority var as well</span>
<a name="GameplaySM.c_65"></a><span class="hl lin">   65 </span><span class="hl kwb">static uint8_t</span> MyPriority<span class="hl opt">;</span>
<a name="GameplaySM.c_66"></a><span class="hl lin">   66 </span>
<a name="GameplaySM.c_67"></a><span class="hl lin">   67 </span>
<a name="GameplaySM.c_68"></a><span class="hl lin">   68 </span><span class="hl com">/*------------------------------ Module Code ------------------------------*/</span>
<a name="GameplaySM.c_69"></a><span class="hl lin">   69 </span><span class="hl com">/****************************************************************************</span>
<a name="GameplaySM.c_70"></a><span class="hl lin">   70 </span><span class="hl com"> Function</span>
<a name="GameplaySM.c_71"></a><span class="hl lin">   71 </span><span class="hl com">     InitGameplaySM</span>
<a name="GameplaySM.c_72"></a><span class="hl lin">   72 </span><span class="hl com"></span>
<a name="GameplaySM.c_73"></a><span class="hl lin">   73 </span><span class="hl com"> Parameters</span>
<a name="GameplaySM.c_74"></a><span class="hl lin">   74 </span><span class="hl com">     uint8_t : the priorty of this service</span>
<a name="GameplaySM.c_75"></a><span class="hl lin">   75 </span><span class="hl com"></span>
<a name="GameplaySM.c_76"></a><span class="hl lin">   76 </span><span class="hl com"> Returns</span>
<a name="GameplaySM.c_77"></a><span class="hl lin">   77 </span><span class="hl com">     boolean, False if error in initialization, True otherwise</span>
<a name="GameplaySM.c_78"></a><span class="hl lin">   78 </span><span class="hl com"></span>
<a name="GameplaySM.c_79"></a><span class="hl lin">   79 </span><span class="hl com"> Description</span>
<a name="GameplaySM.c_80"></a><span class="hl lin">   80 </span><span class="hl com">     Saves away the priority, sets up the initial transition and does any</span>
<a name="GameplaySM.c_81"></a><span class="hl lin">   81 </span><span class="hl com">     other required initialization for this state machine</span>
<a name="GameplaySM.c_82"></a><span class="hl lin">   82 </span><span class="hl com"> Notes</span>
<a name="GameplaySM.c_83"></a><span class="hl lin">   83 </span><span class="hl com"></span>
<a name="GameplaySM.c_84"></a><span class="hl lin">   84 </span><span class="hl com"> Author</span>
<a name="GameplaySM.c_85"></a><span class="hl lin">   85 </span><span class="hl com">     J. Edward Carryer, 10/23/11, 18:55</span>
<a name="GameplaySM.c_86"></a><span class="hl lin">   86 </span><span class="hl com">****************************************************************************/</span>
<a name="GameplaySM.c_87"></a><span class="hl lin">   87 </span>boolean <span class="hl kwd">InitGameplaySM</span> <span class="hl opt">(</span> <span class="hl kwb">uint8_t</span> Priority <span class="hl opt">)</span>
<a name="GameplaySM.c_88"></a><span class="hl lin">   88 </span><span class="hl opt">{</span>
<a name="GameplaySM.c_89"></a><span class="hl lin">   89 </span>    ES_Event ThisEvent<span class="hl opt">;</span>
<a name="GameplaySM.c_90"></a><span class="hl lin">   90 </span>
<a name="GameplaySM.c_91"></a><span class="hl lin">   91 </span>    MyPriority <span class="hl opt">=</span> Priority<span class="hl opt">;</span>
<a name="GameplaySM.c_92"></a><span class="hl lin">   92 </span>    <span class="hl slc">// put us into the Initial PseudoState</span>
<a name="GameplaySM.c_93"></a><span class="hl lin">   93 </span>    CurrentState <span class="hl opt">=</span> InitPStateGameplay<span class="hl opt">;</span>
<a name="GameplaySM.c_94"></a><span class="hl lin">   94 </span>    <span class="hl slc">// post the initial transition event</span>
<a name="GameplaySM.c_95"></a><span class="hl lin">   95 </span>    <span class="hl slc">// puts(&quot;InitGameplaySM\r\n&quot;);</span>
<a name="GameplaySM.c_96"></a><span class="hl lin">   96 </span>
<a name="GameplaySM.c_97"></a><span class="hl lin">   97 </span>    ThisEvent<span class="hl opt">.</span>EventType <span class="hl opt">=</span> ES_INIT<span class="hl opt">;</span>
<a name="GameplaySM.c_98"></a><span class="hl lin">   98 </span>    <span class="hl kwa">if</span> <span class="hl opt">(</span><span class="hl kwd">ES_PostToService</span><span class="hl opt">(</span> MyPriority<span class="hl opt">,</span> ThisEvent<span class="hl opt">) ==</span> True<span class="hl opt">)</span>
<a name="GameplaySM.c_99"></a><span class="hl lin">   99 </span>        <span class="hl opt">{</span>
<a name="GameplaySM.c_100"></a><span class="hl lin">  100 </span>            <span class="hl kwa">return</span> True<span class="hl opt">;</span>
<a name="GameplaySM.c_101"></a><span class="hl lin">  101 </span>        <span class="hl opt">}</span>
<a name="GameplaySM.c_102"></a><span class="hl lin">  102 </span>    <span class="hl kwa">else</span>
<a name="GameplaySM.c_103"></a><span class="hl lin">  103 </span>        <span class="hl opt">{</span>
<a name="GameplaySM.c_104"></a><span class="hl lin">  104 </span>            <span class="hl kwa">return</span> False<span class="hl opt">;</span>
<a name="GameplaySM.c_105"></a><span class="hl lin">  105 </span>        <span class="hl opt">}</span>
<a name="GameplaySM.c_106"></a><span class="hl lin">  106 </span><span class="hl opt">}</span>
<a name="GameplaySM.c_107"></a><span class="hl lin">  107 </span>
<a name="GameplaySM.c_108"></a><span class="hl lin">  108 </span><span class="hl com">/****************************************************************************</span>
<a name="GameplaySM.c_109"></a><span class="hl lin">  109 </span><span class="hl com"> Function</span>
<a name="GameplaySM.c_110"></a><span class="hl lin">  110 </span><span class="hl com">     PostGameplaySM</span>
<a name="GameplaySM.c_111"></a><span class="hl lin">  111 </span><span class="hl com"></span>
<a name="GameplaySM.c_112"></a><span class="hl lin">  112 </span><span class="hl com"> Parameters</span>
<a name="GameplaySM.c_113"></a><span class="hl lin">  113 </span><span class="hl com">     EF_Event ThisEvent , the event to post to the queue</span>
<a name="GameplaySM.c_114"></a><span class="hl lin">  114 </span><span class="hl com"></span>
<a name="GameplaySM.c_115"></a><span class="hl lin">  115 </span><span class="hl com"> Returns</span>
<a name="GameplaySM.c_116"></a><span class="hl lin">  116 </span><span class="hl com">     boolean False if the Enqueue operation failed, True otherwise</span>
<a name="GameplaySM.c_117"></a><span class="hl lin">  117 </span><span class="hl com"></span>
<a name="GameplaySM.c_118"></a><span class="hl lin">  118 </span><span class="hl com"> Description</span>
<a name="GameplaySM.c_119"></a><span class="hl lin">  119 </span><span class="hl com">     Posts an event to this state machine's queue</span>
<a name="GameplaySM.c_120"></a><span class="hl lin">  120 </span><span class="hl com"> Notes</span>
<a name="GameplaySM.c_121"></a><span class="hl lin">  121 </span><span class="hl com"></span>
<a name="GameplaySM.c_122"></a><span class="hl lin">  122 </span><span class="hl com"> Author</span>
<a name="GameplaySM.c_123"></a><span class="hl lin">  123 </span><span class="hl com">     J. Edward Carryer, 10/23/11, 19:25</span>
<a name="GameplaySM.c_124"></a><span class="hl lin">  124 </span><span class="hl com">****************************************************************************/</span>
<a name="GameplaySM.c_125"></a><span class="hl lin">  125 </span>boolean <span class="hl kwd">PostGameplaySM</span><span class="hl opt">(</span> ES_Event ThisEvent <span class="hl opt">)</span>
<a name="GameplaySM.c_126"></a><span class="hl lin">  126 </span><span class="hl opt">{</span>
<a name="GameplaySM.c_127"></a><span class="hl lin">  127 </span>    <span class="hl kwa">return</span> <span class="hl kwd">ES_PostToService</span><span class="hl opt">(</span> MyPriority<span class="hl opt">,</span> ThisEvent<span class="hl opt">);</span>
<a name="GameplaySM.c_128"></a><span class="hl lin">  128 </span><span class="hl opt">}</span>
<a name="GameplaySM.c_129"></a><span class="hl lin">  129 </span>
<a name="GameplaySM.c_130"></a><span class="hl lin">  130 </span><span class="hl com">/****************************************************************************</span>
<a name="GameplaySM.c_131"></a><span class="hl lin">  131 </span><span class="hl com"> Function</span>
<a name="GameplaySM.c_132"></a><span class="hl lin">  132 </span><span class="hl com">    RunGameplaySM</span>
<a name="GameplaySM.c_133"></a><span class="hl lin">  133 </span><span class="hl com"></span>
<a name="GameplaySM.c_134"></a><span class="hl lin">  134 </span><span class="hl com"> Parameters</span>
<a name="GameplaySM.c_135"></a><span class="hl lin">  135 </span><span class="hl com">   ES_Event : the event to process</span>
<a name="GameplaySM.c_136"></a><span class="hl lin">  136 </span><span class="hl com"></span>
<a name="GameplaySM.c_137"></a><span class="hl lin">  137 </span><span class="hl com"> Returns</span>
<a name="GameplaySM.c_138"></a><span class="hl lin">  138 </span><span class="hl com">   ES_Event, ES_NO_EVENT if no error ES_ERROR otherwise</span>
<a name="GameplaySM.c_139"></a><span class="hl lin">  139 </span><span class="hl com"></span>
<a name="GameplaySM.c_140"></a><span class="hl lin">  140 </span><span class="hl com"> Description</span>
<a name="GameplaySM.c_141"></a><span class="hl lin">  141 </span><span class="hl com">   add your description here</span>
<a name="GameplaySM.c_142"></a><span class="hl lin">  142 </span><span class="hl com"> Notes</span>
<a name="GameplaySM.c_143"></a><span class="hl lin">  143 </span><span class="hl com">   uses nested switch/case to implement the machine.</span>
<a name="GameplaySM.c_144"></a><span class="hl lin">  144 </span><span class="hl com"> Author</span>
<a name="GameplaySM.c_145"></a><span class="hl lin">  145 </span><span class="hl com">   J. Edward Carryer, 01/15/12, 15:23</span>
<a name="GameplaySM.c_146"></a><span class="hl lin">  146 </span><span class="hl com">****************************************************************************/</span>
<a name="GameplaySM.c_147"></a><span class="hl lin">  147 </span>ES_Event <span class="hl kwd">RunGameplaySM</span><span class="hl opt">(</span> ES_Event ThisEvent <span class="hl opt">)</span>
<a name="GameplaySM.c_148"></a><span class="hl lin">  148 </span><span class="hl opt">{</span>
<a name="GameplaySM.c_149"></a><span class="hl lin">  149 </span>    ES_Event ReturnEvent<span class="hl opt">;</span>
<a name="GameplaySM.c_150"></a><span class="hl lin">  150 </span>    ReturnEvent<span class="hl opt">.</span>EventType <span class="hl opt">=</span> ES_NO_EVENT<span class="hl opt">;</span> <span class="hl slc">// assume no errors</span>
<a name="GameplaySM.c_151"></a><span class="hl lin">  151 </span>
<a name="GameplaySM.c_152"></a><span class="hl lin">  152 </span>    <span class="hl kwa">switch</span> <span class="hl opt">(</span> CurrentState <span class="hl opt">)</span>
<a name="GameplaySM.c_153"></a><span class="hl lin">  153 </span>        <span class="hl opt">{</span>
<a name="GameplaySM.c_154"></a><span class="hl lin">  154 </span>        <span class="hl kwa">case</span> InitPStateGameplay <span class="hl opt">:</span>       <span class="hl slc">// If current state is initial Pseudo State</span>
<a name="GameplaySM.c_155"></a><span class="hl lin">  155 </span>
<a name="GameplaySM.c_156"></a><span class="hl lin">  156 </span>            <span class="hl kwa">if</span> <span class="hl opt">(</span> ThisEvent<span class="hl opt">.</span>EventType <span class="hl opt">==</span> ES_INIT <span class="hl opt">)</span><span class="hl slc">// only respond to EF_Init</span>
<a name="GameplaySM.c_157"></a><span class="hl lin">  157 </span>                <span class="hl opt">{</span>
<a name="GameplaySM.c_158"></a><span class="hl lin">  158 </span>
<a name="GameplaySM.c_159"></a><span class="hl lin">  159 </span>                    <span class="hl slc">//printf(&quot;Entered Gameplay Pseudo State, Bottom Limit Value is: %i\r\n&quot;, BOTTOM_LIMIT_PORT);</span>
<a name="GameplaySM.c_160"></a><span class="hl lin">  160 </span>                    <span class="hl kwa">if</span> <span class="hl opt">(</span>BOTTOM_LIMIT_PORT <span class="hl opt">!=</span> LO<span class="hl opt">)</span>
<a name="GameplaySM.c_161"></a><span class="hl lin">  161 </span>                        <span class="hl opt">{</span>
<a name="GameplaySM.c_162"></a><span class="hl lin">  162 </span>                            ES_Event ThisEvent<span class="hl opt">;</span>
<a name="GameplaySM.c_163"></a><span class="hl lin">  163 </span>                            ThisEvent<span class="hl opt">.</span>EventType <span class="hl opt">=</span> MOTORREVERSE<span class="hl opt">;</span>
<a name="GameplaySM.c_164"></a><span class="hl lin">  164 </span>                            ThisEvent<span class="hl opt">.</span>EventParam <span class="hl opt">=</span> <span class="hl num">0</span><span class="hl opt">;</span>
<a name="GameplaySM.c_165"></a><span class="hl lin">  165 </span>                            <span class="hl kwd">PostMotorSM</span><span class="hl opt">(</span>ThisEvent<span class="hl opt">);</span>
<a name="GameplaySM.c_166"></a><span class="hl lin">  166 </span>
<a name="GameplaySM.c_167"></a><span class="hl lin">  167 </span>                            CurrentState <span class="hl opt">=</span> Resetting<span class="hl opt">;</span>
<a name="GameplaySM.c_168"></a><span class="hl lin">  168 </span>                        <span class="hl opt">}</span>
<a name="GameplaySM.c_169"></a><span class="hl lin">  169 </span>
<a name="GameplaySM.c_170"></a><span class="hl lin">  170 </span>                    <span class="hl kwa">else</span>
<a name="GameplaySM.c_171"></a><span class="hl lin">  171 </span>                        <span class="hl opt">{</span>
<a name="GameplaySM.c_172"></a><span class="hl lin">  172 </span>
<a name="GameplaySM.c_173"></a><span class="hl lin">  173 </span>                            CurrentState <span class="hl opt">=</span> LockDown<span class="hl opt">;</span>
<a name="GameplaySM.c_174"></a><span class="hl lin">  174 </span>                        <span class="hl opt">}</span>
<a name="GameplaySM.c_175"></a><span class="hl lin">  175 </span>
<a name="GameplaySM.c_176"></a><span class="hl lin">  176 </span>                    <span class="hl kwd">InitLights</span><span class="hl opt">();</span> <span class="hl slc">// Initialize the lights</span>
<a name="GameplaySM.c_177"></a><span class="hl lin">  177 </span>                    BWIN_DIR <span class="hl opt">=</span> <span class="hl num">1</span><span class="hl opt">;</span> <span class="hl slc">//set BWIN lights as outputs</span>
<a name="GameplaySM.c_178"></a><span class="hl lin">  178 </span>
<a name="GameplaySM.c_179"></a><span class="hl lin">  179 </span>
<a name="GameplaySM.c_180"></a><span class="hl lin">  180 </span>
<a name="GameplaySM.c_181"></a><span class="hl lin">  181 </span>                    <span class="hl slc">// Turn Off Oil Slick Prompt</span>
<a name="GameplaySM.c_182"></a><span class="hl lin">  182 </span>                    <span class="hl kwd">BatmanOil</span><span class="hl opt">(</span>OFF<span class="hl opt">);</span>
<a name="GameplaySM.c_183"></a><span class="hl lin">  183 </span>
<a name="GameplaySM.c_184"></a><span class="hl lin">  184 </span>
<a name="GameplaySM.c_185"></a><span class="hl lin">  185 </span>
<a name="GameplaySM.c_186"></a><span class="hl lin">  186 </span>                    <span class="hl slc">//************************ FOR DEBUGGING ONLY!!!!!*******************************</span>
<a name="GameplaySM.c_187"></a><span class="hl lin">  187 </span>                    <span class="hl com">/*ES_Timer_InitTimer(OIL_SLICK_TIMER, OIL_TIME);</span>
<a name="GameplaySM.c_188"></a><span class="hl lin">  188 </span><span class="hl com"></span>
<a name="GameplaySM.c_189"></a><span class="hl lin">  189 </span><span class="hl com">                    ThisEvent.EventType = GAMESTART;</span>
<a name="GameplaySM.c_190"></a><span class="hl lin">  190 </span><span class="hl com">                    ThisEvent.EventParam = 0;</span>
<a name="GameplaySM.c_191"></a><span class="hl lin">  191 </span><span class="hl com">                    PostTimerSM(ThisEvent);</span>
<a name="GameplaySM.c_192"></a><span class="hl lin">  192 </span><span class="hl com"></span>
<a name="GameplaySM.c_193"></a><span class="hl lin">  193 </span><span class="hl com">                    //Generate a new action</span>
<a name="GameplaySM.c_194"></a><span class="hl lin">  194 </span><span class="hl com">                    GenerateNewAction(); */</span>
<a name="GameplaySM.c_195"></a><span class="hl lin">  195 </span>
<a name="GameplaySM.c_196"></a><span class="hl lin">  196 </span>                    <span class="hl slc">//*********************** END DEBUGGING !!!!!!!!!!!!*****************************</span>
<a name="GameplaySM.c_197"></a><span class="hl lin">  197 </span>                    <span class="hl slc">//printf(&quot;I'm in InitPStateGameplay and have set CurrentState to %d\r\n&quot;, CurrentState);</span>
<a name="GameplaySM.c_198"></a><span class="hl lin">  198 </span>
<a name="GameplaySM.c_199"></a><span class="hl lin">  199 </span>                <span class="hl opt">}</span>
<a name="GameplaySM.c_200"></a><span class="hl lin">  200 </span>            <span class="hl kwa">break</span><span class="hl opt">;</span>
<a name="GameplaySM.c_201"></a><span class="hl lin">  201 </span>
<a name="GameplaySM.c_202"></a><span class="hl lin">  202 </span>        <span class="hl kwa">case</span> LockDown <span class="hl opt">:</span>
<a name="GameplaySM.c_203"></a><span class="hl lin">  203 </span>            <span class="hl slc">//printf(&quot;i'm in lockdown, waiting for batid\r\n&quot;);</span>
<a name="GameplaySM.c_204"></a><span class="hl lin">  204 </span>            <span class="hl kwa">switch</span> <span class="hl opt">(</span> ThisEvent<span class="hl opt">.</span>EventType <span class="hl opt">)</span>
<a name="GameplaySM.c_205"></a><span class="hl lin">  205 </span>                <span class="hl opt">{</span>
<a name="GameplaySM.c_206"></a><span class="hl lin">  206 </span>
<a name="GameplaySM.c_207"></a><span class="hl lin">  207 </span>                <span class="hl kwa">case</span> BATID_OK <span class="hl opt">:</span> <span class="hl slc">//If event is BATID_OK</span>
<a name="GameplaySM.c_208"></a><span class="hl lin">  208 </span>                <span class="hl opt">{</span>
<a name="GameplaySM.c_209"></a><span class="hl lin">  209 </span>                    <span class="hl slc">// BATID_OK Event detected, inform Joker C32</span>
<a name="GameplaySM.c_210"></a><span class="hl lin">  210 </span>                    ES_Event ThisEvent<span class="hl opt">;</span>
<a name="GameplaySM.c_211"></a><span class="hl lin">  211 </span>                    ThisEvent<span class="hl opt">.</span>EventType <span class="hl opt">=</span> SENDREQ<span class="hl opt">;</span>
<a name="GameplaySM.c_212"></a><span class="hl lin">  212 </span>                    ThisEvent<span class="hl opt">.</span>EventParam <span class="hl opt">=</span> GameActive<span class="hl opt">;</span>
<a name="GameplaySM.c_213"></a><span class="hl lin">  213 </span>                    <span class="hl kwd">PostComSM</span><span class="hl opt">(</span>ThisEvent<span class="hl opt">);</span>
<a name="GameplaySM.c_214"></a><span class="hl lin">  214 </span>                    <span class="hl slc">//printf(&quot;bat id was ok\r\n&quot;);</span>
<a name="GameplaySM.c_215"></a><span class="hl lin">  215 </span>
<a name="GameplaySM.c_216"></a><span class="hl lin">  216 </span>                    <span class="hl slc">//Decide what the next state will be</span>
<a name="GameplaySM.c_217"></a><span class="hl lin">  217 </span>                    CurrentState <span class="hl opt">=</span> Wait4PedalOk<span class="hl opt">;</span>
<a name="GameplaySM.c_218"></a><span class="hl lin">  218 </span>
<a name="GameplaySM.c_219"></a><span class="hl lin">  219 </span>                    <span class="hl slc">//Flash Pedal Lights to Indicate Change of State to User</span>
<a name="GameplaySM.c_220"></a><span class="hl lin">  220 </span>                    <span class="hl kwd">BatmanPedal</span><span class="hl opt">(</span>AllON<span class="hl opt">);</span>
<a name="GameplaySM.c_221"></a><span class="hl lin">  221 </span>                    <span class="hl kwa">for</span> <span class="hl opt">(</span>i <span class="hl opt">=</span> <span class="hl num">0</span><span class="hl opt">;</span> i <span class="hl opt">&lt;</span><span class="hl num">10000</span><span class="hl opt">;</span> i<span class="hl opt">++);</span>
<a name="GameplaySM.c_222"></a><span class="hl lin">  222 </span>                    <span class="hl kwd">BatmanPedal</span><span class="hl opt">(</span>OFF<span class="hl opt">);</span>
<a name="GameplaySM.c_223"></a><span class="hl lin">  223 </span>                    <span class="hl kwa">for</span> <span class="hl opt">(</span>i <span class="hl opt">=</span> <span class="hl num">0</span><span class="hl opt">;</span> i <span class="hl opt">&lt;</span><span class="hl num">10000</span><span class="hl opt">;</span> i<span class="hl opt">++);</span>
<a name="GameplaySM.c_224"></a><span class="hl lin">  224 </span>                    <span class="hl kwd">BatmanPedal</span><span class="hl opt">(</span>AllON<span class="hl opt">);</span>
<a name="GameplaySM.c_225"></a><span class="hl lin">  225 </span>                    <span class="hl kwa">for</span> <span class="hl opt">(</span>i <span class="hl opt">=</span> <span class="hl num">0</span><span class="hl opt">;</span> i <span class="hl opt">&lt;</span><span class="hl num">10000</span><span class="hl opt">;</span> i<span class="hl opt">++);</span>
<a name="GameplaySM.c_226"></a><span class="hl lin">  226 </span>                    <span class="hl kwd">BatmanPedal</span><span class="hl opt">(</span>OFF<span class="hl opt">);</span>
<a name="GameplaySM.c_227"></a><span class="hl lin">  227 </span>                    <span class="hl kwa">for</span> <span class="hl opt">(</span>i <span class="hl opt">=</span> <span class="hl num">0</span><span class="hl opt">;</span> i <span class="hl opt">&lt;</span><span class="hl num">10000</span><span class="hl opt">;</span> i<span class="hl opt">++);</span>
<a name="GameplaySM.c_228"></a><span class="hl lin">  228 </span>                    <span class="hl kwd">BatmanPedal</span><span class="hl opt">(</span>AllON<span class="hl opt">);</span>
<a name="GameplaySM.c_229"></a><span class="hl lin">  229 </span>                    <span class="hl kwa">for</span> <span class="hl opt">(</span>i <span class="hl opt">=</span> <span class="hl num">0</span><span class="hl opt">;</span> i <span class="hl opt">&lt;</span><span class="hl num">10000</span><span class="hl opt">;</span> i<span class="hl opt">++);</span>
<a name="GameplaySM.c_230"></a><span class="hl lin">  230 </span>                    <span class="hl kwd">BatmanPedal</span><span class="hl opt">(</span>OFF<span class="hl opt">);</span>
<a name="GameplaySM.c_231"></a><span class="hl lin">  231 </span>
<a name="GameplaySM.c_232"></a><span class="hl lin">  232 </span>                    <span class="hl slc">// Check what difficulty level we want to run</span>
<a name="GameplaySM.c_233"></a><span class="hl lin">  233 </span>                    <span class="hl slc">// Initialize the response time based on the Difficulty Level Input</span>
<a name="GameplaySM.c_234"></a><span class="hl lin">  234 </span>                    <span class="hl slc">// This should read the A/D port and assign the difficulty at the beginning</span>
<a name="GameplaySM.c_235"></a><span class="hl lin">  235 </span>                    <span class="hl slc">// Both Batman and Joker need to have calibrated thresholds to judge the</span>
<a name="GameplaySM.c_236"></a><span class="hl lin">  236 </span>                    <span class="hl slc">// response time identically</span>
<a name="GameplaySM.c_237"></a><span class="hl lin">  237 </span>                    <span class="hl slc">// printf(&quot;Difficulty Reading %i\r\n&quot;, ADS12_ReadADPin(DIFFICULTY_PORT));</span>
<a name="GameplaySM.c_238"></a><span class="hl lin">  238 </span>                    <span class="hl kwa">if</span> <span class="hl opt">(</span> <span class="hl kwd">ADS12_ReadADPin</span><span class="hl opt">(</span>DIFFICULTY_PORT<span class="hl opt">) &gt;</span> EASY_THRESHOLD <span class="hl opt">)</span>
<a name="GameplaySM.c_239"></a><span class="hl lin">  239 </span>                        <span class="hl opt">{</span>
<a name="GameplaySM.c_240"></a><span class="hl lin">  240 </span>                            <span class="hl slc">// Set Difficulty to Easy</span>
<a name="GameplaySM.c_241"></a><span class="hl lin">  241 </span>                            <span class="hl kwd">ChangeResponseTime</span><span class="hl opt">(</span>RESPONSE_TIME0<span class="hl opt">);</span>
<a name="GameplaySM.c_242"></a><span class="hl lin">  242 </span>                            <span class="hl slc">//printf(&quot;EASY DIFFICULTY\r\n&quot;);</span>
<a name="GameplaySM.c_243"></a><span class="hl lin">  243 </span>
<a name="GameplaySM.c_244"></a><span class="hl lin">  244 </span>                        <span class="hl opt">}</span>
<a name="GameplaySM.c_245"></a><span class="hl lin">  245 </span>                    <span class="hl kwa">else if</span> <span class="hl opt">(</span> <span class="hl kwd">ADS12_ReadADPin</span><span class="hl opt">(</span>DIFFICULTY_PORT<span class="hl opt">) &lt;</span> EASY_THRESHOLD <span class="hl opt">&amp;&amp;</span> <span class="hl kwd">ADS12_ReadADPin</span><span class="hl opt">(</span>DIFFICULTY_PORT<span class="hl opt">) &gt;</span> HARD_THRESHOLD<span class="hl opt">)</span>
<a name="GameplaySM.c_246"></a><span class="hl lin">  246 </span>                        <span class="hl opt">{</span>
<a name="GameplaySM.c_247"></a><span class="hl lin">  247 </span>                            <span class="hl slc">// Set Difficulty to Medium</span>
<a name="GameplaySM.c_248"></a><span class="hl lin">  248 </span>                            <span class="hl kwd">ChangeResponseTime</span><span class="hl opt">(</span>RESPONSE_TIME1<span class="hl opt">);</span>
<a name="GameplaySM.c_249"></a><span class="hl lin">  249 </span>                            <span class="hl slc">//printf(&quot;MEDIUM DIFFICULTY\r\n&quot;);</span>
<a name="GameplaySM.c_250"></a><span class="hl lin">  250 </span>                        <span class="hl opt">}</span>
<a name="GameplaySM.c_251"></a><span class="hl lin">  251 </span>                    <span class="hl kwa">else</span>
<a name="GameplaySM.c_252"></a><span class="hl lin">  252 </span>                        <span class="hl opt">{</span>
<a name="GameplaySM.c_253"></a><span class="hl lin">  253 </span>                            <span class="hl slc">// Set Difficulty to Hard</span>
<a name="GameplaySM.c_254"></a><span class="hl lin">  254 </span>                            <span class="hl kwd">ChangeResponseTime</span><span class="hl opt">(</span>RESPONSE_TIME2<span class="hl opt">);</span>
<a name="GameplaySM.c_255"></a><span class="hl lin">  255 </span>                            <span class="hl slc">//printf(&quot;HARD DIFFICULTY\r\n&quot;);</span>
<a name="GameplaySM.c_256"></a><span class="hl lin">  256 </span>                        <span class="hl opt">}</span>
<a name="GameplaySM.c_257"></a><span class="hl lin">  257 </span>
<a name="GameplaySM.c_258"></a><span class="hl lin">  258 </span>                    <span class="hl slc">// Start Difficulty Timer</span>
<a name="GameplaySM.c_259"></a><span class="hl lin">  259 </span>                    <span class="hl kwd">ES_Timer_InitTimer</span><span class="hl opt">(</span>DIFFICULTY_TIMER<span class="hl opt">,</span> DIFFICULTY_TIME<span class="hl opt">);</span>
<a name="GameplaySM.c_260"></a><span class="hl lin">  260 </span>                <span class="hl opt">}</span>
<a name="GameplaySM.c_261"></a><span class="hl lin">  261 </span>                <span class="hl kwa">break</span><span class="hl opt">;</span>
<a name="GameplaySM.c_262"></a><span class="hl lin">  262 </span>
<a name="GameplaySM.c_263"></a><span class="hl lin">  263 </span>                <span class="hl kwa">case</span> PEDAL <span class="hl opt">:</span>
<a name="GameplaySM.c_264"></a><span class="hl lin">  264 </span>                <span class="hl opt">{</span>
<a name="GameplaySM.c_265"></a><span class="hl lin">  265 </span>                    <span class="hl slc">// Start Updating PedalArray based on pedal events</span>
<a name="GameplaySM.c_266"></a><span class="hl lin">  266 </span>                    <span class="hl kwd">BatmanPedal</span><span class="hl opt">(</span>ThisEvent<span class="hl opt">.</span>EventParam<span class="hl opt">);</span>
<a name="GameplaySM.c_267"></a><span class="hl lin">  267 </span>
<a name="GameplaySM.c_268"></a><span class="hl lin">  268 </span>                    <span class="hl slc">// Change the NextAction State</span>
<a name="GameplaySM.c_269"></a><span class="hl lin">  269 </span>                    <span class="hl kwd">ChangeAction</span><span class="hl opt">();</span>
<a name="GameplaySM.c_270"></a><span class="hl lin">  270 </span>                <span class="hl opt">}</span>
<a name="GameplaySM.c_271"></a><span class="hl lin">  271 </span>                <span class="hl kwa">break</span><span class="hl opt">;</span>
<a name="GameplaySM.c_272"></a><span class="hl lin">  272 </span>                <span class="hl opt">}</span>
<a name="GameplaySM.c_273"></a><span class="hl lin">  273 </span>            <span class="hl kwa">break</span><span class="hl opt">;</span>
<a name="GameplaySM.c_274"></a><span class="hl lin">  274 </span>
<a name="GameplaySM.c_275"></a><span class="hl lin">  275 </span>        <span class="hl kwa">case</span> Wait4PedalOk <span class="hl opt">:</span>
<a name="GameplaySM.c_276"></a><span class="hl lin">  276 </span>
<a name="GameplaySM.c_277"></a><span class="hl lin">  277 </span>            <span class="hl slc">//printf(&quot;I'm in Wait4Pedal\r\n&quot;);</span>
<a name="GameplaySM.c_278"></a><span class="hl lin">  278 </span>
<a name="GameplaySM.c_279"></a><span class="hl lin">  279 </span>            <span class="hl kwa">switch</span> <span class="hl opt">(</span> ThisEvent<span class="hl opt">.</span>EventType <span class="hl opt">)</span>
<a name="GameplaySM.c_280"></a><span class="hl lin">  280 </span>                <span class="hl opt">{</span>
<a name="GameplaySM.c_281"></a><span class="hl lin">  281 </span>                <span class="hl kwa">case</span> PEDAL <span class="hl opt">:</span>
<a name="GameplaySM.c_282"></a><span class="hl lin">  282 </span>                <span class="hl opt">{</span>
<a name="GameplaySM.c_283"></a><span class="hl lin">  283 </span>                    <span class="hl slc">// Start Updating PedalArray based on pedal events</span>
<a name="GameplaySM.c_284"></a><span class="hl lin">  284 </span>                    <span class="hl kwd">BatmanPedal</span><span class="hl opt">(</span>ThisEvent<span class="hl opt">.</span>EventParam<span class="hl opt">);</span>
<a name="GameplaySM.c_285"></a><span class="hl lin">  285 </span>
<a name="GameplaySM.c_286"></a><span class="hl lin">  286 </span>                    <span class="hl slc">// Change the NextAction State</span>
<a name="GameplaySM.c_287"></a><span class="hl lin">  287 </span>                    <span class="hl kwd">ChangeAction</span><span class="hl opt">();</span>
<a name="GameplaySM.c_288"></a><span class="hl lin">  288 </span>
<a name="GameplaySM.c_289"></a><span class="hl lin">  289 </span>                    <span class="hl slc">// Check Value of Batman Pedal to start or continue Timer</span>
<a name="GameplaySM.c_290"></a><span class="hl lin">  290 </span>                    <span class="hl kwa">if</span> <span class="hl opt">((</span>ThisEvent<span class="hl opt">.</span>EventParam <span class="hl opt">&gt;</span> Band2ON<span class="hl opt">) &amp;&amp; (</span>ThisEvent<span class="hl opt">.</span>EventParam <span class="hl opt">&lt;</span> Band7ON<span class="hl opt">))</span>
<a name="GameplaySM.c_291"></a><span class="hl lin">  291 </span>                        <span class="hl opt">{</span>
<a name="GameplaySM.c_292"></a><span class="hl lin">  292 </span>
<a name="GameplaySM.c_293"></a><span class="hl lin">  293 </span>                            <span class="hl kwa">if</span> <span class="hl opt">(</span>PedalTimer <span class="hl opt">==</span> OFF<span class="hl opt">)</span>
<a name="GameplaySM.c_294"></a><span class="hl lin">  294 </span>                                <span class="hl opt">{</span>
<a name="GameplaySM.c_295"></a><span class="hl lin">  295 </span>                                    PedalTimer <span class="hl opt">=</span> ON<span class="hl opt">;</span>
<a name="GameplaySM.c_296"></a><span class="hl lin">  296 </span>
<a name="GameplaySM.c_297"></a><span class="hl lin">  297 </span>                                    <span class="hl kwd">ES_Timer_SetTimer</span><span class="hl opt">(</span>RESPONSE_TIMER<span class="hl opt">,</span> PEDAL_TIME<span class="hl opt">);</span>
<a name="GameplaySM.c_298"></a><span class="hl lin">  298 </span>                                    <span class="hl kwd">ES_Timer_StartTimer</span><span class="hl opt">(</span>RESPONSE_TIMER<span class="hl opt">);</span>
<a name="GameplaySM.c_299"></a><span class="hl lin">  299 </span>                                <span class="hl opt">}</span>
<a name="GameplaySM.c_300"></a><span class="hl lin">  300 </span>                        <span class="hl opt">}</span>
<a name="GameplaySM.c_301"></a><span class="hl lin">  301 </span>                    <span class="hl kwa">else</span>
<a name="GameplaySM.c_302"></a><span class="hl lin">  302 </span>                        <span class="hl opt">{</span>
<a name="GameplaySM.c_303"></a><span class="hl lin">  303 </span>                            PedalTimer <span class="hl opt">=</span> OFF<span class="hl opt">;</span>
<a name="GameplaySM.c_304"></a><span class="hl lin">  304 </span>                            <span class="hl kwd">ES_Timer_StopTimer</span><span class="hl opt">(</span>RESPONSE_TIMER<span class="hl opt">);</span>
<a name="GameplaySM.c_305"></a><span class="hl lin">  305 </span>                        <span class="hl opt">}</span>
<a name="GameplaySM.c_306"></a><span class="hl lin">  306 </span>                <span class="hl opt">}</span>
<a name="GameplaySM.c_307"></a><span class="hl lin">  307 </span>                <span class="hl kwa">break</span><span class="hl opt">;</span>
<a name="GameplaySM.c_308"></a><span class="hl lin">  308 </span>
<a name="GameplaySM.c_309"></a><span class="hl lin">  309 </span>                <span class="hl kwa">case</span> ES_TIMEOUT <span class="hl opt">:</span>
<a name="GameplaySM.c_310"></a><span class="hl lin">  310 </span>                <span class="hl opt">{</span>
<a name="GameplaySM.c_311"></a><span class="hl lin">  311 </span>
<a name="GameplaySM.c_312"></a><span class="hl lin">  312 </span>                    <span class="hl kwa">if</span> <span class="hl opt">(</span>ThisEvent<span class="hl opt">.</span>EventParam <span class="hl opt">==</span> RESPONSE_TIMER<span class="hl opt">)</span>
<a name="GameplaySM.c_313"></a><span class="hl lin">  313 </span>                        <span class="hl opt">{</span>
<a name="GameplaySM.c_314"></a><span class="hl lin">  314 </span>                            <span class="hl slc">// Tell Joker We're Ready</span>
<a name="GameplaySM.c_315"></a><span class="hl lin">  315 </span>                            ES_Event ThisEvent<span class="hl opt">;</span>
<a name="GameplaySM.c_316"></a><span class="hl lin">  316 </span>                            ThisEvent<span class="hl opt">.</span>EventType <span class="hl opt">=</span> SENDREQ<span class="hl opt">;</span>
<a name="GameplaySM.c_317"></a><span class="hl lin">  317 </span>                            ThisEvent<span class="hl opt">.</span>EventParam <span class="hl opt">=</span> BatmanReady<span class="hl opt">;</span>
<a name="GameplaySM.c_318"></a><span class="hl lin">  318 </span>                            <span class="hl kwd">PostComSM</span><span class="hl opt">(</span>ThisEvent<span class="hl opt">);</span>
<a name="GameplaySM.c_319"></a><span class="hl lin">  319 </span>
<a name="GameplaySM.c_320"></a><span class="hl lin">  320 </span>                            <span class="hl slc">// Set Current State to Wait4Partner</span>
<a name="GameplaySM.c_321"></a><span class="hl lin">  321 </span>                            CurrentState <span class="hl opt">=</span> Wait4Partner<span class="hl opt">;</span>
<a name="GameplaySM.c_322"></a><span class="hl lin">  322 </span>                        <span class="hl opt">}</span>
<a name="GameplaySM.c_323"></a><span class="hl lin">  323 </span>                <span class="hl opt">}</span>
<a name="GameplaySM.c_324"></a><span class="hl lin">  324 </span>                <span class="hl kwa">break</span><span class="hl opt">;</span>
<a name="GameplaySM.c_325"></a><span class="hl lin">  325 </span>
<a name="GameplaySM.c_326"></a><span class="hl lin">  326 </span>                <span class="hl kwa">case</span> GAME_END <span class="hl opt">:</span> <span class="hl slc">// ResponseRecorded, Wait4Response, OilPause, Wait4Bomb</span>
<a name="GameplaySM.c_327"></a><span class="hl lin">  327 </span>                <span class="hl opt">{</span>
<a name="GameplaySM.c_328"></a><span class="hl lin">  328 </span>                    <span class="hl slc">// Time Over and go to LockDown</span>
<a name="GameplaySM.c_329"></a><span class="hl lin">  329 </span>
<a name="GameplaySM.c_330"></a><span class="hl lin">  330 </span>                    <span class="hl slc">// printf(&quot;Got Game End Event from Joker\r\n&quot;);</span>
<a name="GameplaySM.c_331"></a><span class="hl lin">  331 </span>
<a name="GameplaySM.c_332"></a><span class="hl lin">  332 </span>                    <span class="hl slc">// Got GAME_END Event From Joker Game Timer</span>
<a name="GameplaySM.c_333"></a><span class="hl lin">  333 </span>                    BWIN_LIGHTS <span class="hl opt">=</span> <span class="hl num">0</span><span class="hl opt">;</span> <span class="hl slc">//turn lights off</span>
<a name="GameplaySM.c_334"></a><span class="hl lin">  334 </span>                    <span class="hl kwd">BatmanPedal</span><span class="hl opt">(</span>OFF<span class="hl opt">);</span>
<a name="GameplaySM.c_335"></a><span class="hl lin">  335 </span>                    <span class="hl kwd">BatmanSide</span><span class="hl opt">(</span>OFF<span class="hl opt">);</span>
<a name="GameplaySM.c_336"></a><span class="hl lin">  336 </span>                    <span class="hl kwd">BatmanOil</span><span class="hl opt">(</span>OFF<span class="hl opt">);</span>
<a name="GameplaySM.c_337"></a><span class="hl lin">  337 </span>                    <span class="hl kwd">BatmanLaser</span><span class="hl opt">(</span>OFF<span class="hl opt">);</span>
<a name="GameplaySM.c_338"></a><span class="hl lin">  338 </span>
<a name="GameplaySM.c_339"></a><span class="hl lin">  339 </span>                    <span class="hl slc">//Ensure BWIN_LIGHTS Off</span>
<a name="GameplaySM.c_340"></a><span class="hl lin">  340 </span>                    BWIN_LIGHTS <span class="hl opt">=</span> <span class="hl num">0</span><span class="hl opt">;</span>
<a name="GameplaySM.c_341"></a><span class="hl lin">  341 </span>
<a name="GameplaySM.c_342"></a><span class="hl lin">  342 </span>                    <span class="hl slc">// Set</span>
<a name="GameplaySM.c_343"></a><span class="hl lin">  343 </span>                    CurrentState <span class="hl opt">=</span> LockDown<span class="hl opt">;</span>
<a name="GameplaySM.c_344"></a><span class="hl lin">  344 </span>                <span class="hl opt">}</span>
<a name="GameplaySM.c_345"></a><span class="hl lin">  345 </span>                <span class="hl kwa">break</span><span class="hl opt">;</span>
<a name="GameplaySM.c_346"></a><span class="hl lin">  346 </span>
<a name="GameplaySM.c_347"></a><span class="hl lin">  347 </span>                <span class="hl kwa">case</span> JOKERREADY <span class="hl opt">:</span>
<a name="GameplaySM.c_348"></a><span class="hl lin">  348 </span>                <span class="hl opt">{</span>
<a name="GameplaySM.c_349"></a><span class="hl lin">  349 </span>                    <span class="hl slc">// Put GameplaySM into PartnerReady State</span>
<a name="GameplaySM.c_350"></a><span class="hl lin">  350 </span>                    CurrentState <span class="hl opt">=</span> PartnerReady<span class="hl opt">;</span>
<a name="GameplaySM.c_351"></a><span class="hl lin">  351 </span>                <span class="hl opt">}</span>
<a name="GameplaySM.c_352"></a><span class="hl lin">  352 </span>                <span class="hl kwa">break</span><span class="hl opt">;</span>
<a name="GameplaySM.c_353"></a><span class="hl lin">  353 </span>
<a name="GameplaySM.c_354"></a><span class="hl lin">  354 </span>                <span class="hl opt">}</span>
<a name="GameplaySM.c_355"></a><span class="hl lin">  355 </span>            <span class="hl kwa">break</span><span class="hl opt">;</span>
<a name="GameplaySM.c_356"></a><span class="hl lin">  356 </span>
<a name="GameplaySM.c_357"></a><span class="hl lin">  357 </span>        <span class="hl kwa">case</span> Wait4Partner <span class="hl opt">:</span>
<a name="GameplaySM.c_358"></a><span class="hl lin">  358 </span>
<a name="GameplaySM.c_359"></a><span class="hl lin">  359 </span>            <span class="hl slc">// printf(&quot;I'm in Wait4Partner\r\n&quot;);</span>
<a name="GameplaySM.c_360"></a><span class="hl lin">  360 </span>
<a name="GameplaySM.c_361"></a><span class="hl lin">  361 </span>            <span class="hl kwa">switch</span> <span class="hl opt">(</span> ThisEvent<span class="hl opt">.</span>EventType <span class="hl opt">)</span>
<a name="GameplaySM.c_362"></a><span class="hl lin">  362 </span>                <span class="hl opt">{</span>
<a name="GameplaySM.c_363"></a><span class="hl lin">  363 </span>                <span class="hl kwa">case</span> JOKERREADY <span class="hl opt">:</span>
<a name="GameplaySM.c_364"></a><span class="hl lin">  364 </span>                <span class="hl opt">{</span>
<a name="GameplaySM.c_365"></a><span class="hl lin">  365 </span>                    <span class="hl slc">// Start Motor Moving Up</span>
<a name="GameplaySM.c_366"></a><span class="hl lin">  366 </span>                    ES_Event ThisEvent<span class="hl opt">;</span>
<a name="GameplaySM.c_367"></a><span class="hl lin">  367 </span>                    ThisEvent<span class="hl opt">.</span>EventType <span class="hl opt">=</span> MOTORSTART<span class="hl opt">;</span>
<a name="GameplaySM.c_368"></a><span class="hl lin">  368 </span>                    ThisEvent<span class="hl opt">.</span>EventParam <span class="hl opt">=</span> <span class="hl num">0</span><span class="hl opt">;</span>
<a name="GameplaySM.c_369"></a><span class="hl lin">  369 </span>                    <span class="hl kwd">PostMotorSM</span><span class="hl opt">(</span>ThisEvent<span class="hl opt">);</span>
<a name="GameplaySM.c_370"></a><span class="hl lin">  370 </span>
<a name="GameplaySM.c_371"></a><span class="hl lin">  371 </span>                    <span class="hl slc">// Put GameplaySM into Wait4Response State and start first action</span>
<a name="GameplaySM.c_372"></a><span class="hl lin">  372 </span>                    CurrentState <span class="hl opt">=</span> Wait4Response<span class="hl opt">;</span>
<a name="GameplaySM.c_373"></a><span class="hl lin">  373 </span>
<a name="GameplaySM.c_374"></a><span class="hl lin">  374 </span>                    <span class="hl slc">// Start Oil Slick Timer</span>
<a name="GameplaySM.c_375"></a><span class="hl lin">  375 </span>                    <span class="hl kwd">ES_Timer_InitTimer</span><span class="hl opt">(</span>OIL_SLICK_TIMER<span class="hl opt">,</span> OIL_TIME<span class="hl opt">);</span>
<a name="GameplaySM.c_376"></a><span class="hl lin">  376 </span>
<a name="GameplaySM.c_377"></a><span class="hl lin">  377 </span>                    <span class="hl slc">// Enter Gameplay Mode, prompt user input</span>
<a name="GameplaySM.c_378"></a><span class="hl lin">  378 </span>                    <span class="hl kwd">GenerateNewAction</span><span class="hl opt">();</span>
<a name="GameplaySM.c_379"></a><span class="hl lin">  379 </span>                <span class="hl opt">}</span>
<a name="GameplaySM.c_380"></a><span class="hl lin">  380 </span>                <span class="hl kwa">break</span><span class="hl opt">;</span>
<a name="GameplaySM.c_381"></a><span class="hl lin">  381 </span>
<a name="GameplaySM.c_382"></a><span class="hl lin">  382 </span>                <span class="hl kwa">case</span> PEDAL <span class="hl opt">:</span>
<a name="GameplaySM.c_383"></a><span class="hl lin">  383 </span>                <span class="hl opt">{</span>
<a name="GameplaySM.c_384"></a><span class="hl lin">  384 </span>                    <span class="hl slc">// Start Updating PedalArray based on pedal events</span>
<a name="GameplaySM.c_385"></a><span class="hl lin">  385 </span>                    <span class="hl kwd">BatmanPedal</span><span class="hl opt">(</span>ThisEvent<span class="hl opt">.</span>EventParam<span class="hl opt">);</span>
<a name="GameplaySM.c_386"></a><span class="hl lin">  386 </span>
<a name="GameplaySM.c_387"></a><span class="hl lin">  387 </span>                    <span class="hl slc">// Change the NextAction State</span>
<a name="GameplaySM.c_388"></a><span class="hl lin">  388 </span>                    <span class="hl kwd">ChangeAction</span><span class="hl opt">();</span>
<a name="GameplaySM.c_389"></a><span class="hl lin">  389 </span>                <span class="hl opt">}</span>
<a name="GameplaySM.c_390"></a><span class="hl lin">  390 </span>                <span class="hl kwa">break</span><span class="hl opt">;</span>
<a name="GameplaySM.c_391"></a><span class="hl lin">  391 </span>
<a name="GameplaySM.c_392"></a><span class="hl lin">  392 </span>                <span class="hl kwa">case</span> GAME_END <span class="hl opt">:</span> <span class="hl slc">// ResponseRecorded, Wait4Response, OilPause, Wait4Bomb</span>
<a name="GameplaySM.c_393"></a><span class="hl lin">  393 </span>                <span class="hl opt">{</span>
<a name="GameplaySM.c_394"></a><span class="hl lin">  394 </span>                    <span class="hl slc">// Got GAME_END Event From Joker Game Timer</span>
<a name="GameplaySM.c_395"></a><span class="hl lin">  395 </span>                    BWIN_LIGHTS <span class="hl opt">=</span> <span class="hl num">0</span><span class="hl opt">;</span> <span class="hl slc">//turn lights off</span>
<a name="GameplaySM.c_396"></a><span class="hl lin">  396 </span>                    <span class="hl kwd">BatmanPedal</span><span class="hl opt">(</span>OFF<span class="hl opt">);</span>
<a name="GameplaySM.c_397"></a><span class="hl lin">  397 </span>                    <span class="hl kwd">BatmanSide</span><span class="hl opt">(</span>OFF<span class="hl opt">);</span>
<a name="GameplaySM.c_398"></a><span class="hl lin">  398 </span>                    <span class="hl kwd">BatmanOil</span><span class="hl opt">(</span>OFF<span class="hl opt">);</span>
<a name="GameplaySM.c_399"></a><span class="hl lin">  399 </span>                    <span class="hl kwd">BatmanLaser</span><span class="hl opt">(</span>OFF<span class="hl opt">);</span>
<a name="GameplaySM.c_400"></a><span class="hl lin">  400 </span>
<a name="GameplaySM.c_401"></a><span class="hl lin">  401 </span>                    <span class="hl slc">// Ensure BATWIN_LIGHTS are Off</span>
<a name="GameplaySM.c_402"></a><span class="hl lin">  402 </span>                    BWIN_LIGHTS <span class="hl opt">=</span> <span class="hl num">0</span><span class="hl opt">;</span>
<a name="GameplaySM.c_403"></a><span class="hl lin">  403 </span>
<a name="GameplaySM.c_404"></a><span class="hl lin">  404 </span>                    <span class="hl slc">// Change CurrentState to LockDown</span>
<a name="GameplaySM.c_405"></a><span class="hl lin">  405 </span>                    CurrentState <span class="hl opt">=</span> LockDown<span class="hl opt">;</span>
<a name="GameplaySM.c_406"></a><span class="hl lin">  406 </span>                <span class="hl opt">}</span>
<a name="GameplaySM.c_407"></a><span class="hl lin">  407 </span>                <span class="hl kwa">break</span><span class="hl opt">;</span>
<a name="GameplaySM.c_408"></a><span class="hl lin">  408 </span>                <span class="hl opt">}</span>                           <span class="hl slc">// end switch on CurrentEvent</span>
<a name="GameplaySM.c_409"></a><span class="hl lin">  409 </span>            <span class="hl kwa">break</span><span class="hl opt">;</span>
<a name="GameplaySM.c_410"></a><span class="hl lin">  410 </span>
<a name="GameplaySM.c_411"></a><span class="hl lin">  411 </span>        <span class="hl kwa">case</span> PartnerReady <span class="hl opt">:</span>
<a name="GameplaySM.c_412"></a><span class="hl lin">  412 </span>            <span class="hl slc">//printf(&quot;I'm in PartnerReady\r\n&quot;);</span>
<a name="GameplaySM.c_413"></a><span class="hl lin">  413 </span>
<a name="GameplaySM.c_414"></a><span class="hl lin">  414 </span>            <span class="hl kwa">switch</span> <span class="hl opt">(</span> ThisEvent<span class="hl opt">.</span>EventType <span class="hl opt">)</span>
<a name="GameplaySM.c_415"></a><span class="hl lin">  415 </span>                <span class="hl opt">{</span>
<a name="GameplaySM.c_416"></a><span class="hl lin">  416 </span>                    <span class="hl slc">// Check if the Pedal has moved out of acceptable range</span>
<a name="GameplaySM.c_417"></a><span class="hl lin">  417 </span>                <span class="hl kwa">case</span> PEDAL <span class="hl opt">:</span>
<a name="GameplaySM.c_418"></a><span class="hl lin">  418 </span>                <span class="hl opt">{</span>
<a name="GameplaySM.c_419"></a><span class="hl lin">  419 </span>                    <span class="hl slc">// Start Updating PedalArray based on pedal events</span>
<a name="GameplaySM.c_420"></a><span class="hl lin">  420 </span>                    <span class="hl kwd">BatmanPedal</span><span class="hl opt">(</span>ThisEvent<span class="hl opt">.</span>EventParam<span class="hl opt">);</span>
<a name="GameplaySM.c_421"></a><span class="hl lin">  421 </span>
<a name="GameplaySM.c_422"></a><span class="hl lin">  422 </span>                    <span class="hl slc">// Change the NextAction State</span>
<a name="GameplaySM.c_423"></a><span class="hl lin">  423 </span>                    <span class="hl kwd">ChangeAction</span><span class="hl opt">();</span>
<a name="GameplaySM.c_424"></a><span class="hl lin">  424 </span>
<a name="GameplaySM.c_425"></a><span class="hl lin">  425 </span>                    <span class="hl slc">// Check Value of Batman Pedal to start or continue Timer</span>
<a name="GameplaySM.c_426"></a><span class="hl lin">  426 </span>                    <span class="hl kwa">if</span> <span class="hl opt">((</span>ThisEvent<span class="hl opt">.</span>EventParam <span class="hl opt">&gt;</span> Band2ON<span class="hl opt">) &amp;&amp; (</span>ThisEvent<span class="hl opt">.</span>EventParam <span class="hl opt">&lt;</span> Band7ON<span class="hl opt">))</span>
<a name="GameplaySM.c_427"></a><span class="hl lin">  427 </span>                        <span class="hl opt">{</span>
<a name="GameplaySM.c_428"></a><span class="hl lin">  428 </span>
<a name="GameplaySM.c_429"></a><span class="hl lin">  429 </span>                            <span class="hl kwa">if</span> <span class="hl opt">(</span>PedalTimer <span class="hl opt">==</span> OFF<span class="hl opt">)</span>
<a name="GameplaySM.c_430"></a><span class="hl lin">  430 </span>                                <span class="hl opt">{</span>
<a name="GameplaySM.c_431"></a><span class="hl lin">  431 </span>                                    PedalTimer <span class="hl opt">=</span> ON<span class="hl opt">;</span>
<a name="GameplaySM.c_432"></a><span class="hl lin">  432 </span>                                    <span class="hl kwd">ES_Timer_SetTimer</span><span class="hl opt">(</span>RESPONSE_TIMER<span class="hl opt">,</span> PEDAL_TIME<span class="hl opt">);</span>
<a name="GameplaySM.c_433"></a><span class="hl lin">  433 </span>                                    <span class="hl kwd">ES_Timer_StartTimer</span><span class="hl opt">(</span>RESPONSE_TIMER<span class="hl opt">);</span>
<a name="GameplaySM.c_434"></a><span class="hl lin">  434 </span>                                <span class="hl opt">}</span>
<a name="GameplaySM.c_435"></a><span class="hl lin">  435 </span>                        <span class="hl opt">}</span>
<a name="GameplaySM.c_436"></a><span class="hl lin">  436 </span>                    <span class="hl kwa">else</span>
<a name="GameplaySM.c_437"></a><span class="hl lin">  437 </span>                        <span class="hl opt">{</span>
<a name="GameplaySM.c_438"></a><span class="hl lin">  438 </span>                            PedalTimer <span class="hl opt">=</span> OFF<span class="hl opt">;</span>
<a name="GameplaySM.c_439"></a><span class="hl lin">  439 </span>                            <span class="hl kwd">ES_Timer_StopTimer</span><span class="hl opt">(</span>RESPONSE_TIMER<span class="hl opt">);</span>
<a name="GameplaySM.c_440"></a><span class="hl lin">  440 </span>                        <span class="hl opt">}</span>
<a name="GameplaySM.c_441"></a><span class="hl lin">  441 </span>                <span class="hl opt">}</span>
<a name="GameplaySM.c_442"></a><span class="hl lin">  442 </span>                <span class="hl kwa">break</span><span class="hl opt">;</span>
<a name="GameplaySM.c_443"></a><span class="hl lin">  443 </span>
<a name="GameplaySM.c_444"></a><span class="hl lin">  444 </span>                <span class="hl slc">// Check if users have kept Pedal in acceptable range for required time</span>
<a name="GameplaySM.c_445"></a><span class="hl lin">  445 </span>                <span class="hl kwa">case</span> ES_TIMEOUT <span class="hl opt">:</span>
<a name="GameplaySM.c_446"></a><span class="hl lin">  446 </span>                <span class="hl opt">{</span>
<a name="GameplaySM.c_447"></a><span class="hl lin">  447 </span>                    <span class="hl kwa">if</span> <span class="hl opt">(</span>ThisEvent<span class="hl opt">.</span>EventParam <span class="hl opt">==</span> RESPONSE_TIMER<span class="hl opt">)</span>
<a name="GameplaySM.c_448"></a><span class="hl lin">  448 </span>                        <span class="hl opt">{</span>
<a name="GameplaySM.c_449"></a><span class="hl lin">  449 </span>                            <span class="hl slc">// Declare Events that must be posted</span>
<a name="GameplaySM.c_450"></a><span class="hl lin">  450 </span>                            ES_Event ThisEvent<span class="hl opt">,</span> ThatEvent<span class="hl opt">;</span>
<a name="GameplaySM.c_451"></a><span class="hl lin">  451 </span>
<a name="GameplaySM.c_452"></a><span class="hl lin">  452 </span>                            <span class="hl slc">// Send message to Joker that Batman is Ready</span>
<a name="GameplaySM.c_453"></a><span class="hl lin">  453 </span>                            ThisEvent<span class="hl opt">.</span>EventType <span class="hl opt">=</span> SENDREQ<span class="hl opt">;</span>
<a name="GameplaySM.c_454"></a><span class="hl lin">  454 </span>                            ThisEvent<span class="hl opt">.</span>EventParam <span class="hl opt">=</span> BatmanReady<span class="hl opt">;</span>
<a name="GameplaySM.c_455"></a><span class="hl lin">  455 </span>                            <span class="hl kwd">PostComSM</span><span class="hl opt">(</span>ThisEvent<span class="hl opt">);</span>
<a name="GameplaySM.c_456"></a><span class="hl lin">  456 </span>
<a name="GameplaySM.c_457"></a><span class="hl lin">  457 </span>                            <span class="hl slc">// Post Event to MotorSM that Batman needs to start moving</span>
<a name="GameplaySM.c_458"></a><span class="hl lin">  458 </span>                            ThatEvent<span class="hl opt">.</span>EventType <span class="hl opt">=</span> MOTORSTART<span class="hl opt">;</span>
<a name="GameplaySM.c_459"></a><span class="hl lin">  459 </span>                            ThatEvent<span class="hl opt">.</span>EventParam <span class="hl opt">=</span> <span class="hl num">0</span><span class="hl opt">;</span>
<a name="GameplaySM.c_460"></a><span class="hl lin">  460 </span>                            <span class="hl kwd">PostMotorSM</span><span class="hl opt">(</span>ThatEvent<span class="hl opt">);</span>
<a name="GameplaySM.c_461"></a><span class="hl lin">  461 </span>
<a name="GameplaySM.c_462"></a><span class="hl lin">  462 </span>                            <span class="hl slc">// Put GameplaySM into Wait4Response State and start first action</span>
<a name="GameplaySM.c_463"></a><span class="hl lin">  463 </span>                            CurrentState <span class="hl opt">=</span> Wait4Response<span class="hl opt">;</span>
<a name="GameplaySM.c_464"></a><span class="hl lin">  464 </span>
<a name="GameplaySM.c_465"></a><span class="hl lin">  465 </span>                            <span class="hl slc">// Start Oil Slick Timer</span>
<a name="GameplaySM.c_466"></a><span class="hl lin">  466 </span>                            <span class="hl kwd">ES_Timer_InitTimer</span><span class="hl opt">(</span>OIL_SLICK_TIMER<span class="hl opt">,</span> OIL_TIME<span class="hl opt">);</span>
<a name="GameplaySM.c_467"></a><span class="hl lin">  467 </span>
<a name="GameplaySM.c_468"></a><span class="hl lin">  468 </span>                            <span class="hl slc">// Enter into Gameplay mode and prompt user</span>
<a name="GameplaySM.c_469"></a><span class="hl lin">  469 </span>                            <span class="hl kwd">GenerateNewAction</span><span class="hl opt">();</span>
<a name="GameplaySM.c_470"></a><span class="hl lin">  470 </span>                        <span class="hl opt">}</span>
<a name="GameplaySM.c_471"></a><span class="hl lin">  471 </span>                <span class="hl opt">}</span>
<a name="GameplaySM.c_472"></a><span class="hl lin">  472 </span>                <span class="hl kwa">break</span><span class="hl opt">;</span>
<a name="GameplaySM.c_473"></a><span class="hl lin">  473 </span>
<a name="GameplaySM.c_474"></a><span class="hl lin">  474 </span>                <span class="hl kwa">case</span> GAME_END <span class="hl opt">:</span> <span class="hl slc">// ResponseRecorded, Wait4Response, OilPause, Wait4Bomb</span>
<a name="GameplaySM.c_475"></a><span class="hl lin">  475 </span>                <span class="hl opt">{</span>
<a name="GameplaySM.c_476"></a><span class="hl lin">  476 </span>                    <span class="hl slc">// Time Over and go to LockDown</span>
<a name="GameplaySM.c_477"></a><span class="hl lin">  477 </span>                    BWIN_LIGHTS <span class="hl opt">=</span> <span class="hl num">0</span><span class="hl opt">;</span> <span class="hl slc">//turn lights off</span>
<a name="GameplaySM.c_478"></a><span class="hl lin">  478 </span>                    <span class="hl kwd">BatmanPedal</span><span class="hl opt">(</span>OFF<span class="hl opt">);</span>
<a name="GameplaySM.c_479"></a><span class="hl lin">  479 </span>                    <span class="hl kwd">BatmanSide</span><span class="hl opt">(</span>OFF<span class="hl opt">);</span>
<a name="GameplaySM.c_480"></a><span class="hl lin">  480 </span>                    <span class="hl kwd">BatmanOil</span><span class="hl opt">(</span>OFF<span class="hl opt">);</span>
<a name="GameplaySM.c_481"></a><span class="hl lin">  481 </span>                    <span class="hl kwd">BatmanLaser</span><span class="hl opt">(</span>OFF<span class="hl opt">);</span>
<a name="GameplaySM.c_482"></a><span class="hl lin">  482 </span>
<a name="GameplaySM.c_483"></a><span class="hl lin">  483 </span>                    <span class="hl slc">// Ensure BATWIN_LIGHTS are Off</span>
<a name="GameplaySM.c_484"></a><span class="hl lin">  484 </span>                    BWIN_LIGHTS <span class="hl opt">=</span> <span class="hl num">0</span><span class="hl opt">;</span>
<a name="GameplaySM.c_485"></a><span class="hl lin">  485 </span>
<a name="GameplaySM.c_486"></a><span class="hl lin">  486 </span>                    <span class="hl slc">// Set CurrentState to LockDown</span>
<a name="GameplaySM.c_487"></a><span class="hl lin">  487 </span>                    CurrentState <span class="hl opt">=</span> LockDown<span class="hl opt">;</span>
<a name="GameplaySM.c_488"></a><span class="hl lin">  488 </span>                <span class="hl opt">}</span>
<a name="GameplaySM.c_489"></a><span class="hl lin">  489 </span>                <span class="hl kwa">break</span><span class="hl opt">;</span>
<a name="GameplaySM.c_490"></a><span class="hl lin">  490 </span>                <span class="hl opt">}</span>                           <span class="hl slc">// end switch on CurrentEvent</span>
<a name="GameplaySM.c_491"></a><span class="hl lin">  491 </span>            <span class="hl kwa">break</span><span class="hl opt">;</span>
<a name="GameplaySM.c_492"></a><span class="hl lin">  492 </span>
<a name="GameplaySM.c_493"></a><span class="hl lin">  493 </span>        <span class="hl kwa">case</span> Wait4Response <span class="hl opt">:</span>       <span class="hl slc">// If current state is state one</span>
<a name="GameplaySM.c_494"></a><span class="hl lin">  494 </span>
<a name="GameplaySM.c_495"></a><span class="hl lin">  495 </span>            <span class="hl slc">//printf(&quot;I'm in Wait4Response\r\n&quot;);</span>
<a name="GameplaySM.c_496"></a><span class="hl lin">  496 </span>
<a name="GameplaySM.c_497"></a><span class="hl lin">  497 </span>            <span class="hl kwa">switch</span> <span class="hl opt">(</span> ThisEvent<span class="hl opt">.</span>EventType <span class="hl opt">)</span>
<a name="GameplaySM.c_498"></a><span class="hl lin">  498 </span>                <span class="hl opt">{</span>
<a name="GameplaySM.c_499"></a><span class="hl lin">  499 </span>                    <span class="hl com">/* Need to look for following events:</span>
<a name="GameplaySM.c_500"></a><span class="hl lin">  500 </span><span class="hl com">                      BEAMBREAK</span>
<a name="GameplaySM.c_501"></a><span class="hl lin">  501 </span><span class="hl com">                      SIDEBUTTON</span>
<a name="GameplaySM.c_502"></a><span class="hl lin">  502 </span><span class="hl com">                      OILSLICK</span>
<a name="GameplaySM.c_503"></a><span class="hl lin">  503 </span><span class="hl com">                      DEFUSE</span>
<a name="GameplaySM.c_504"></a><span class="hl lin">  504 </span><span class="hl com">                      BTOP</span>
<a name="GameplaySM.c_505"></a><span class="hl lin">  505 </span><span class="hl com">                      BMID</span>
<a name="GameplaySM.c_506"></a><span class="hl lin">  506 </span><span class="hl com">                      OILSLICK From ComSM</span>
<a name="GameplaySM.c_507"></a><span class="hl lin">  507 </span><span class="hl com">                      OILINDICATE From ComSM</span>
<a name="GameplaySM.c_508"></a><span class="hl lin">  508 </span><span class="hl com">                      DETONATE From ComSM</span>
<a name="GameplaySM.c_509"></a><span class="hl lin">  509 </span><span class="hl com"></span>
<a name="GameplaySM.c_510"></a><span class="hl lin">  510 </span><span class="hl com">                    **************************************/</span>
<a name="GameplaySM.c_511"></a><span class="hl lin">  511 </span>                <span class="hl kwa">case</span> BEAMBREAK <span class="hl opt">:</span> <span class="hl slc">// Only Wait4Response</span>
<a name="GameplaySM.c_512"></a><span class="hl lin">  512 </span>                <span class="hl opt">{</span>
<a name="GameplaySM.c_513"></a><span class="hl lin">  513 </span>                    <span class="hl kwd">EvalAction</span><span class="hl opt">(</span> ThisEvent <span class="hl opt">);</span>
<a name="GameplaySM.c_514"></a><span class="hl lin">  514 </span>                    CurrentState <span class="hl opt">=</span> ResponseRecorded<span class="hl opt">;</span>
<a name="GameplaySM.c_515"></a><span class="hl lin">  515 </span>                <span class="hl opt">}</span>
<a name="GameplaySM.c_516"></a><span class="hl lin">  516 </span>                <span class="hl kwa">break</span><span class="hl opt">;</span>
<a name="GameplaySM.c_517"></a><span class="hl lin">  517 </span>
<a name="GameplaySM.c_518"></a><span class="hl lin">  518 </span>                <span class="hl kwa">case</span> SIDEBUTTON <span class="hl opt">:</span> <span class="hl slc">// Only Wait4Response</span>
<a name="GameplaySM.c_519"></a><span class="hl lin">  519 </span>                <span class="hl opt">{</span>
<a name="GameplaySM.c_520"></a><span class="hl lin">  520 </span>                    <span class="hl kwd">EvalAction</span><span class="hl opt">(</span> ThisEvent <span class="hl opt">);</span>
<a name="GameplaySM.c_521"></a><span class="hl lin">  521 </span>                    CurrentState <span class="hl opt">=</span> ResponseRecorded<span class="hl opt">;</span>
<a name="GameplaySM.c_522"></a><span class="hl lin">  522 </span>                <span class="hl opt">}</span>
<a name="GameplaySM.c_523"></a><span class="hl lin">  523 </span>                <span class="hl kwa">break</span><span class="hl opt">;</span>
<a name="GameplaySM.c_524"></a><span class="hl lin">  524 </span>
<a name="GameplaySM.c_525"></a><span class="hl lin">  525 </span>                <span class="hl kwa">case</span> OILSLICK <span class="hl opt">:</span> <span class="hl slc">// ResponseRecorded and Wait4Response</span>
<a name="GameplaySM.c_526"></a><span class="hl lin">  526 </span>                <span class="hl opt">{</span>
<a name="GameplaySM.c_527"></a><span class="hl lin">  527 </span>                    <span class="hl kwd">EvalOilAction</span><span class="hl opt">(</span> ThisEvent <span class="hl opt">);</span>
<a name="GameplaySM.c_528"></a><span class="hl lin">  528 </span>                <span class="hl opt">}</span>
<a name="GameplaySM.c_529"></a><span class="hl lin">  529 </span>                <span class="hl kwa">break</span><span class="hl opt">;</span>
<a name="GameplaySM.c_530"></a><span class="hl lin">  530 </span>
<a name="GameplaySM.c_531"></a><span class="hl lin">  531 </span>                <span class="hl kwa">case</span> JOKERWIN <span class="hl opt">:</span> <span class="hl slc">// ResponseRecorded, Wait4Response, OilPause, Wait4Bomb</span>
<a name="GameplaySM.c_532"></a><span class="hl lin">  532 </span>                <span class="hl opt">{</span>
<a name="GameplaySM.c_533"></a><span class="hl lin">  533 </span>                    ES_Event ThisEvent<span class="hl opt">;</span>
<a name="GameplaySM.c_534"></a><span class="hl lin">  534 </span>                    ThisEvent<span class="hl opt">.</span>EventType <span class="hl opt">=</span> MOTORSTOP<span class="hl opt">;</span>
<a name="GameplaySM.c_535"></a><span class="hl lin">  535 </span>                    ThisEvent<span class="hl opt">.</span>EventParam <span class="hl opt">=</span> <span class="hl num">0</span><span class="hl opt">;</span>
<a name="GameplaySM.c_536"></a><span class="hl lin">  536 </span>                    <span class="hl kwd">PostMotorSM</span><span class="hl opt">(</span>ThisEvent<span class="hl opt">);</span>
<a name="GameplaySM.c_537"></a><span class="hl lin">  537 </span>                    <span class="hl kwd">ES_Timer_InitTimer</span><span class="hl opt">(</span>RESPONSE_TIMER<span class="hl opt">,</span> CELEBRATION_TIME<span class="hl opt">);</span>
<a name="GameplaySM.c_538"></a><span class="hl lin">  538 </span>
<a name="GameplaySM.c_539"></a><span class="hl lin">  539 </span>                    <span class="hl slc">// Turn Off BATWIN_LIGHTS</span>
<a name="GameplaySM.c_540"></a><span class="hl lin">  540 </span>                    BWIN_LIGHTS <span class="hl opt">=</span> OFF<span class="hl opt">;</span>
<a name="GameplaySM.c_541"></a><span class="hl lin">  541 </span>
<a name="GameplaySM.c_542"></a><span class="hl lin">  542 </span>                    <span class="hl slc">// Set CurrentState to GameOver</span>
<a name="GameplaySM.c_543"></a><span class="hl lin">  543 </span>                    CurrentState <span class="hl opt">=</span> GameOver<span class="hl opt">;</span>
<a name="GameplaySM.c_544"></a><span class="hl lin">  544 </span>                <span class="hl opt">}</span>
<a name="GameplaySM.c_545"></a><span class="hl lin">  545 </span>                <span class="hl kwa">break</span><span class="hl opt">;</span>
<a name="GameplaySM.c_546"></a><span class="hl lin">  546 </span>
<a name="GameplaySM.c_547"></a><span class="hl lin">  547 </span>                <span class="hl kwa">case</span> JOKERLOSE <span class="hl opt">:</span> <span class="hl slc">// ResponseRecorded, Wait4Response, OilPause, Wait4Bomb</span>
<a name="GameplaySM.c_548"></a><span class="hl lin">  548 </span>                <span class="hl opt">{</span>
<a name="GameplaySM.c_549"></a><span class="hl lin">  549 </span>                    <span class="hl slc">//Start Celebration Timer</span>
<a name="GameplaySM.c_550"></a><span class="hl lin">  550 </span>                    ES_Event ThisEvent<span class="hl opt">;</span>
<a name="GameplaySM.c_551"></a><span class="hl lin">  551 </span>                    ThisEvent<span class="hl opt">.</span>EventType <span class="hl opt">=</span> MOTORSTOP<span class="hl opt">;</span>
<a name="GameplaySM.c_552"></a><span class="hl lin">  552 </span>                    ThisEvent<span class="hl opt">.</span>EventParam <span class="hl opt">=</span> <span class="hl num">0</span><span class="hl opt">;</span>
<a name="GameplaySM.c_553"></a><span class="hl lin">  553 </span>                    <span class="hl kwd">PostMotorSM</span><span class="hl opt">(</span>ThisEvent<span class="hl opt">);</span>
<a name="GameplaySM.c_554"></a><span class="hl lin">  554 </span>
<a name="GameplaySM.c_555"></a><span class="hl lin">  555 </span>                    <span class="hl slc">// Ensure BATWIN_LIGHTS On</span>
<a name="GameplaySM.c_556"></a><span class="hl lin">  556 </span>                    BWIN_LIGHTS <span class="hl opt">=</span> <span class="hl num">1</span><span class="hl opt">;</span>
<a name="GameplaySM.c_557"></a><span class="hl lin">  557 </span>                    <span class="hl kwd">ES_Timer_InitTimer</span><span class="hl opt">(</span>RESPONSE_TIMER<span class="hl opt">,</span> CELEBRATION_TIME<span class="hl opt">);</span>
<a name="GameplaySM.c_558"></a><span class="hl lin">  558 </span>
<a name="GameplaySM.c_559"></a><span class="hl lin">  559 </span>                    <span class="hl slc">// Set CurrentState to GameOver</span>
<a name="GameplaySM.c_560"></a><span class="hl lin">  560 </span>                    CurrentState <span class="hl opt">=</span> GameOver<span class="hl opt">;</span>
<a name="GameplaySM.c_561"></a><span class="hl lin">  561 </span>                <span class="hl opt">}</span>
<a name="GameplaySM.c_562"></a><span class="hl lin">  562 </span>                <span class="hl kwa">break</span><span class="hl opt">;</span>
<a name="GameplaySM.c_563"></a><span class="hl lin">  563 </span>
<a name="GameplaySM.c_564"></a><span class="hl lin">  564 </span>                <span class="hl kwa">case</span> ES_TIMEOUT <span class="hl opt">:</span>
<a name="GameplaySM.c_565"></a><span class="hl lin">  565 </span>                <span class="hl opt">{</span>
<a name="GameplaySM.c_566"></a><span class="hl lin">  566 </span>                    <span class="hl slc">// We have reached the OilSlick point in the game</span>
<a name="GameplaySM.c_567"></a><span class="hl lin">  567 </span>                    <span class="hl slc">// Indicate to the players to press the Oil Slick Button</span>
<a name="GameplaySM.c_568"></a><span class="hl lin">  568 </span>                    <span class="hl kwa">if</span> <span class="hl opt">(</span>ThisEvent<span class="hl opt">.</span>EventParam <span class="hl opt">==</span> OIL_SLICK_TIMER<span class="hl opt">)</span>
<a name="GameplaySM.c_569"></a><span class="hl lin">  569 </span>                        <span class="hl opt">{</span>
<a name="GameplaySM.c_570"></a><span class="hl lin">  570 </span>                            <span class="hl slc">// Send prompt to Joker</span>
<a name="GameplaySM.c_571"></a><span class="hl lin">  571 </span>                            ES_Event ThisEvent<span class="hl opt">;</span>
<a name="GameplaySM.c_572"></a><span class="hl lin">  572 </span>                            ThisEvent<span class="hl opt">.</span>EventType <span class="hl opt">=</span> SENDREQ<span class="hl opt">;</span>
<a name="GameplaySM.c_573"></a><span class="hl lin">  573 </span>                            ThisEvent<span class="hl opt">.</span>EventParam <span class="hl opt">=</span> OilIndicate<span class="hl opt">;</span>
<a name="GameplaySM.c_574"></a><span class="hl lin">  574 </span>                            <span class="hl kwd">PostComSM</span><span class="hl opt">(</span>ThisEvent<span class="hl opt">);</span>
<a name="GameplaySM.c_575"></a><span class="hl lin">  575 </span>
<a name="GameplaySM.c_576"></a><span class="hl lin">  576 </span>                            <span class="hl slc">// Capture OilSlick Prompt is on</span>
<a name="GameplaySM.c_577"></a><span class="hl lin">  577 </span>                            OilPrompt <span class="hl opt">=</span> ON<span class="hl opt">;</span> <span class="hl slc">// Should be put into function</span>
<a name="GameplaySM.c_578"></a><span class="hl lin">  578 </span>
<a name="GameplaySM.c_579"></a><span class="hl lin">  579 </span>                            <span class="hl slc">// Turn on Oil Slick Prompt</span>
<a name="GameplaySM.c_580"></a><span class="hl lin">  580 </span>                            <span class="hl kwd">BatmanOil</span><span class="hl opt">(</span>OilON<span class="hl opt">);</span>
<a name="GameplaySM.c_581"></a><span class="hl lin">  581 </span>
<a name="GameplaySM.c_582"></a><span class="hl lin">  582 </span>                        <span class="hl opt">}</span>
<a name="GameplaySM.c_583"></a><span class="hl lin">  583 </span>
<a name="GameplaySM.c_584"></a><span class="hl lin">  584 </span>                    <span class="hl kwa">else if</span> <span class="hl opt">(</span>ThisEvent<span class="hl opt">.</span>EventParam <span class="hl opt">==</span> RESPONSE_TIMER<span class="hl opt">)</span>
<a name="GameplaySM.c_585"></a><span class="hl lin">  585 </span>                        <span class="hl opt">{</span>
<a name="GameplaySM.c_586"></a><span class="hl lin">  586 </span>                            <span class="hl slc">// Timed out, you get penalized</span>
<a name="GameplaySM.c_587"></a><span class="hl lin">  587 </span>                            ES_Event ThisEvent<span class="hl opt">;</span>
<a name="GameplaySM.c_588"></a><span class="hl lin">  588 </span>                            ThisEvent<span class="hl opt">.</span>EventType <span class="hl opt">=</span> MOTORSLOW<span class="hl opt">;</span>
<a name="GameplaySM.c_589"></a><span class="hl lin">  589 </span>                            ThisEvent<span class="hl opt">.</span>EventParam <span class="hl opt">=</span> <span class="hl num">0</span><span class="hl opt">;</span>
<a name="GameplaySM.c_590"></a><span class="hl lin">  590 </span>                            <span class="hl kwd">PostMotorSM</span><span class="hl opt">(</span>ThisEvent<span class="hl opt">);</span>
<a name="GameplaySM.c_591"></a><span class="hl lin">  591 </span>
<a name="GameplaySM.c_592"></a><span class="hl lin">  592 </span>                            <span class="hl slc">// Put GameplaySM into Wait4Response State and start first action</span>
<a name="GameplaySM.c_593"></a><span class="hl lin">  593 </span>                            CurrentState <span class="hl opt">=</span> Wait4Response<span class="hl opt">;</span>
<a name="GameplaySM.c_594"></a><span class="hl lin">  594 </span>                            <span class="hl kwd">GenerateNewAction</span><span class="hl opt">();</span>
<a name="GameplaySM.c_595"></a><span class="hl lin">  595 </span>
<a name="GameplaySM.c_596"></a><span class="hl lin">  596 </span>                        <span class="hl opt">}</span>
<a name="GameplaySM.c_597"></a><span class="hl lin">  597 </span>
<a name="GameplaySM.c_598"></a><span class="hl lin">  598 </span>                    <span class="hl kwa">else if</span> <span class="hl opt">(</span>ThisEvent<span class="hl opt">.</span>EventParam <span class="hl opt">==</span> DIFFICULTY_TIMER<span class="hl opt">)</span>
<a name="GameplaySM.c_599"></a><span class="hl lin">  599 </span>                        <span class="hl opt">{</span>
<a name="GameplaySM.c_600"></a><span class="hl lin">  600 </span>                            <span class="hl slc">// Timed out, your Responses Required Faster</span>
<a name="GameplaySM.c_601"></a><span class="hl lin">  601 </span>                            <span class="hl kwd">ChangeResponseTime</span><span class="hl opt">(</span>RESPONSE_TIME2 <span class="hl opt">-</span> RESPONSE_TIME_INCREMENT<span class="hl opt">);</span>
<a name="GameplaySM.c_602"></a><span class="hl lin">  602 </span>
<a name="GameplaySM.c_603"></a><span class="hl lin">  603 </span>                        <span class="hl opt">}</span>
<a name="GameplaySM.c_604"></a><span class="hl lin">  604 </span>
<a name="GameplaySM.c_605"></a><span class="hl lin">  605 </span>
<a name="GameplaySM.c_606"></a><span class="hl lin">  606 </span>                <span class="hl opt">}</span>
<a name="GameplaySM.c_607"></a><span class="hl lin">  607 </span>                <span class="hl kwa">break</span><span class="hl opt">;</span>
<a name="GameplaySM.c_608"></a><span class="hl lin">  608 </span>
<a name="GameplaySM.c_609"></a><span class="hl lin">  609 </span>                <span class="hl kwa">case</span> GAME_END <span class="hl opt">:</span> <span class="hl slc">// ResponseRecorded, Wait4Response, OilPause, Wait4Bomb</span>
<a name="GameplaySM.c_610"></a><span class="hl lin">  610 </span>                <span class="hl opt">{</span>
<a name="GameplaySM.c_611"></a><span class="hl lin">  611 </span>                    <span class="hl slc">// Time Over and go to LockDown</span>
<a name="GameplaySM.c_612"></a><span class="hl lin">  612 </span>                    BWIN_LIGHTS <span class="hl opt">=</span> <span class="hl num">0</span><span class="hl opt">;</span> <span class="hl slc">//turn lights off</span>
<a name="GameplaySM.c_613"></a><span class="hl lin">  613 </span>                    <span class="hl kwd">BatmanPedal</span><span class="hl opt">(</span>OFF<span class="hl opt">);</span>
<a name="GameplaySM.c_614"></a><span class="hl lin">  614 </span>                    <span class="hl kwd">BatmanSide</span><span class="hl opt">(</span>OFF<span class="hl opt">);</span>
<a name="GameplaySM.c_615"></a><span class="hl lin">  615 </span>                    <span class="hl kwd">BatmanOil</span><span class="hl opt">(</span>OFF<span class="hl opt">);</span>
<a name="GameplaySM.c_616"></a><span class="hl lin">  616 </span>                    <span class="hl kwd">BatmanLaser</span><span class="hl opt">(</span>OFF<span class="hl opt">);</span>
<a name="GameplaySM.c_617"></a><span class="hl lin">  617 </span>
<a name="GameplaySM.c_618"></a><span class="hl lin">  618 </span>                    <span class="hl slc">// Ensure BATWIN_LIGHTS are Off</span>
<a name="GameplaySM.c_619"></a><span class="hl lin">  619 </span>                    BWIN_LIGHTS <span class="hl opt">=</span> <span class="hl num">0</span><span class="hl opt">;</span>
<a name="GameplaySM.c_620"></a><span class="hl lin">  620 </span>
<a name="GameplaySM.c_621"></a><span class="hl lin">  621 </span>                    <span class="hl slc">// Set CurrentState to LockDown</span>
<a name="GameplaySM.c_622"></a><span class="hl lin">  622 </span>                    CurrentState <span class="hl opt">=</span> LockDown<span class="hl opt">;</span>
<a name="GameplaySM.c_623"></a><span class="hl lin">  623 </span>                <span class="hl opt">}</span>
<a name="GameplaySM.c_624"></a><span class="hl lin">  624 </span>                <span class="hl kwa">break</span><span class="hl opt">;</span>
<a name="GameplaySM.c_625"></a><span class="hl lin">  625 </span>
<a name="GameplaySM.c_626"></a><span class="hl lin">  626 </span>                <span class="hl kwa">case</span> PEDAL <span class="hl opt">:</span>
<a name="GameplaySM.c_627"></a><span class="hl lin">  627 </span>                <span class="hl opt">{</span>
<a name="GameplaySM.c_628"></a><span class="hl lin">  628 </span>                    <span class="hl slc">// Start Updating PedalArray based on pedal events</span>
<a name="GameplaySM.c_629"></a><span class="hl lin">  629 </span>                    <span class="hl kwd">BatmanPedal</span><span class="hl opt">(</span>ThisEvent<span class="hl opt">.</span>EventParam<span class="hl opt">);</span>
<a name="GameplaySM.c_630"></a><span class="hl lin">  630 </span>
<a name="GameplaySM.c_631"></a><span class="hl lin">  631 </span>                    <span class="hl slc">// Change the NextAction State</span>
<a name="GameplaySM.c_632"></a><span class="hl lin">  632 </span>                    <span class="hl kwd">ChangeAction</span><span class="hl opt">();</span>
<a name="GameplaySM.c_633"></a><span class="hl lin">  633 </span>                <span class="hl opt">}</span>
<a name="GameplaySM.c_634"></a><span class="hl lin">  634 </span>                <span class="hl kwa">break</span><span class="hl opt">;</span>
<a name="GameplaySM.c_635"></a><span class="hl lin">  635 </span>
<a name="GameplaySM.c_636"></a><span class="hl lin">  636 </span>                <span class="hl kwa">case</span> DEFUSE <span class="hl opt">:</span>
<a name="GameplaySM.c_637"></a><span class="hl lin">  637 </span>                <span class="hl opt">{</span>
<a name="GameplaySM.c_638"></a><span class="hl lin">  638 </span>                    <span class="hl slc">// Call function to evaluate who wins</span>
<a name="GameplaySM.c_639"></a><span class="hl lin">  639 </span>                    <span class="hl kwd">EvalGameEnd</span><span class="hl opt">();</span>
<a name="GameplaySM.c_640"></a><span class="hl lin">  640 </span>
<a name="GameplaySM.c_641"></a><span class="hl lin">  641 </span>                    <span class="hl slc">// Set CurrentState to GameOver</span>
<a name="GameplaySM.c_642"></a><span class="hl lin">  642 </span>                    CurrentState <span class="hl opt">=</span> GameOver<span class="hl opt">;</span>
<a name="GameplaySM.c_643"></a><span class="hl lin">  643 </span>                <span class="hl opt">}</span>
<a name="GameplaySM.c_644"></a><span class="hl lin">  644 </span>                <span class="hl kwa">break</span><span class="hl opt">;</span>
<a name="GameplaySM.c_645"></a><span class="hl lin">  645 </span>
<a name="GameplaySM.c_646"></a><span class="hl lin">  646 </span>                <span class="hl kwa">case</span> BTOP <span class="hl opt">:</span>
<a name="GameplaySM.c_647"></a><span class="hl lin">  647 </span>                <span class="hl opt">{</span>
<a name="GameplaySM.c_648"></a><span class="hl lin">  648 </span>                    <span class="hl slc">// Batman at the top of the building, stop the motor</span>
<a name="GameplaySM.c_649"></a><span class="hl lin">  649 </span>                    ES_Event ThisEvent<span class="hl opt">;</span>
<a name="GameplaySM.c_650"></a><span class="hl lin">  650 </span>                    ThisEvent<span class="hl opt">.</span>EventType <span class="hl opt">=</span> MOTORSTOP<span class="hl opt">;</span>
<a name="GameplaySM.c_651"></a><span class="hl lin">  651 </span>                    ThisEvent<span class="hl opt">.</span>EventParam <span class="hl opt">=</span> <span class="hl num">0</span><span class="hl opt">;</span>
<a name="GameplaySM.c_652"></a><span class="hl lin">  652 </span>                    <span class="hl kwd">PostMotorSM</span><span class="hl opt">(</span>ThisEvent<span class="hl opt">);</span>
<a name="GameplaySM.c_653"></a><span class="hl lin">  653 </span>
<a name="GameplaySM.c_654"></a><span class="hl lin">  654 </span>                    <span class="hl slc">// Set CurrentState to Wait4Bomb</span>
<a name="GameplaySM.c_655"></a><span class="hl lin">  655 </span>                    CurrentState <span class="hl opt">=</span> Wait4Bomb<span class="hl opt">;</span>
<a name="GameplaySM.c_656"></a><span class="hl lin">  656 </span>                <span class="hl opt">}</span>
<a name="GameplaySM.c_657"></a><span class="hl lin">  657 </span>                <span class="hl kwa">break</span><span class="hl opt">;</span>
<a name="GameplaySM.c_658"></a><span class="hl lin">  658 </span>
<a name="GameplaySM.c_659"></a><span class="hl lin">  659 </span>                <span class="hl com">/* case BMID :</span>
<a name="GameplaySM.c_660"></a><span class="hl lin">  660 </span><span class="hl com">                {</span>
<a name="GameplaySM.c_661"></a><span class="hl lin">  661 </span><span class="hl com">                     ChangeResponseTime(RESPONSE_TIME2);</span>
<a name="GameplaySM.c_662"></a><span class="hl lin">  662 </span><span class="hl com">                }</span>
<a name="GameplaySM.c_663"></a><span class="hl lin">  663 </span><span class="hl com">                break; */</span>
<a name="GameplaySM.c_664"></a><span class="hl lin">  664 </span>
<a name="GameplaySM.c_665"></a><span class="hl lin">  665 </span>                <span class="hl opt">}</span> <span class="hl slc">// end switch on CurrentEvent</span>
<a name="GameplaySM.c_666"></a><span class="hl lin">  666 </span>            <span class="hl kwa">break</span><span class="hl opt">;</span>
<a name="GameplaySM.c_667"></a><span class="hl lin">  667 </span>
<a name="GameplaySM.c_668"></a><span class="hl lin">  668 </span>        <span class="hl kwa">case</span> ResponseRecorded <span class="hl opt">:</span>
<a name="GameplaySM.c_669"></a><span class="hl lin">  669 </span>            <span class="hl slc">//printf(&quot;I'm in ResponseRecorded\r\n&quot;);</span>
<a name="GameplaySM.c_670"></a><span class="hl lin">  670 </span>
<a name="GameplaySM.c_671"></a><span class="hl lin">  671 </span>            <span class="hl kwa">switch</span> <span class="hl opt">(</span> ThisEvent<span class="hl opt">.</span>EventType <span class="hl opt">)</span>
<a name="GameplaySM.c_672"></a><span class="hl lin">  672 </span>                <span class="hl opt">{</span>
<a name="GameplaySM.c_673"></a><span class="hl lin">  673 </span>                <span class="hl kwa">case</span> PEDAL <span class="hl opt">:</span>
<a name="GameplaySM.c_674"></a><span class="hl lin">  674 </span>                <span class="hl opt">{</span>
<a name="GameplaySM.c_675"></a><span class="hl lin">  675 </span>                    <span class="hl slc">// Start Updating PedalArray based on pedal events</span>
<a name="GameplaySM.c_676"></a><span class="hl lin">  676 </span>                    <span class="hl kwd">BatmanPedal</span><span class="hl opt">(</span>ThisEvent<span class="hl opt">.</span>EventParam<span class="hl opt">);</span>
<a name="GameplaySM.c_677"></a><span class="hl lin">  677 </span>
<a name="GameplaySM.c_678"></a><span class="hl lin">  678 </span>                    <span class="hl slc">// Change the NextAction State</span>
<a name="GameplaySM.c_679"></a><span class="hl lin">  679 </span>                    <span class="hl kwd">ChangeAction</span><span class="hl opt">();</span>
<a name="GameplaySM.c_680"></a><span class="hl lin">  680 </span>                <span class="hl opt">}</span>
<a name="GameplaySM.c_681"></a><span class="hl lin">  681 </span>                <span class="hl kwa">break</span><span class="hl opt">;</span>
<a name="GameplaySM.c_682"></a><span class="hl lin">  682 </span>
<a name="GameplaySM.c_683"></a><span class="hl lin">  683 </span>                <span class="hl kwa">case</span> ES_TIMEOUT <span class="hl opt">:</span>
<a name="GameplaySM.c_684"></a><span class="hl lin">  684 </span>                <span class="hl opt">{</span>
<a name="GameplaySM.c_685"></a><span class="hl lin">  685 </span>                    <span class="hl slc">// We have reached the OilSlick point in the game</span>
<a name="GameplaySM.c_686"></a><span class="hl lin">  686 </span>                    <span class="hl slc">// Indicate to the players to press the Oil Slick Button</span>
<a name="GameplaySM.c_687"></a><span class="hl lin">  687 </span>                    <span class="hl kwa">if</span> <span class="hl opt">(</span>ThisEvent<span class="hl opt">.</span>EventParam <span class="hl opt">==</span> OIL_SLICK_TIMER<span class="hl opt">)</span>
<a name="GameplaySM.c_688"></a><span class="hl lin">  688 </span>                        <span class="hl opt">{</span>
<a name="GameplaySM.c_689"></a><span class="hl lin">  689 </span>                            <span class="hl slc">// Send prompt to Joker</span>
<a name="GameplaySM.c_690"></a><span class="hl lin">  690 </span>                            ES_Event ThisEvent<span class="hl opt">;</span>
<a name="GameplaySM.c_691"></a><span class="hl lin">  691 </span>                            ThisEvent<span class="hl opt">.</span>EventType <span class="hl opt">=</span> SENDREQ<span class="hl opt">;</span>
<a name="GameplaySM.c_692"></a><span class="hl lin">  692 </span>                            ThisEvent<span class="hl opt">.</span>EventParam <span class="hl opt">=</span> OilIndicate<span class="hl opt">;</span>
<a name="GameplaySM.c_693"></a><span class="hl lin">  693 </span>                            <span class="hl kwd">PostComSM</span><span class="hl opt">(</span>ThisEvent<span class="hl opt">);</span>
<a name="GameplaySM.c_694"></a><span class="hl lin">  694 </span>
<a name="GameplaySM.c_695"></a><span class="hl lin">  695 </span>                            <span class="hl slc">// Capture OilSlick Prompt is on</span>
<a name="GameplaySM.c_696"></a><span class="hl lin">  696 </span>                            OilPrompt <span class="hl opt">=</span> ON<span class="hl opt">;</span> <span class="hl slc">// Should be put into function</span>
<a name="GameplaySM.c_697"></a><span class="hl lin">  697 </span>
<a name="GameplaySM.c_698"></a><span class="hl lin">  698 </span>                            <span class="hl slc">// Turn on Oil Slick Prompt</span>
<a name="GameplaySM.c_699"></a><span class="hl lin">  699 </span>                            <span class="hl kwd">BatmanOil</span><span class="hl opt">(</span>OilON<span class="hl opt">);</span>
<a name="GameplaySM.c_700"></a><span class="hl lin">  700 </span>                        <span class="hl opt">}</span>
<a name="GameplaySM.c_701"></a><span class="hl lin">  701 </span>                    <span class="hl kwa">else if</span> <span class="hl opt">(</span>ThisEvent<span class="hl opt">.</span>EventParam <span class="hl opt">==</span> RESPONSE_TIMER<span class="hl opt">)</span>
<a name="GameplaySM.c_702"></a><span class="hl lin">  702 </span>                        <span class="hl opt">{</span>
<a name="GameplaySM.c_703"></a><span class="hl lin">  703 </span>                            <span class="hl slc">// Put GameplaySM into Wait4Response State and start first action</span>
<a name="GameplaySM.c_704"></a><span class="hl lin">  704 </span>                            CurrentState <span class="hl opt">=</span> Wait4Response<span class="hl opt">;</span>
<a name="GameplaySM.c_705"></a><span class="hl lin">  705 </span>
<a name="GameplaySM.c_706"></a><span class="hl lin">  706 </span>                            <span class="hl slc">// Generate a new action to prompt the user with</span>
<a name="GameplaySM.c_707"></a><span class="hl lin">  707 </span>                            <span class="hl kwd">GenerateNewAction</span><span class="hl opt">();</span>
<a name="GameplaySM.c_708"></a><span class="hl lin">  708 </span>                        <span class="hl opt">}</span>
<a name="GameplaySM.c_709"></a><span class="hl lin">  709 </span>                    <span class="hl kwa">else if</span> <span class="hl opt">(</span>ThisEvent<span class="hl opt">.</span>EventParam <span class="hl opt">==</span> DIFFICULTY_TIMER<span class="hl opt">)</span>
<a name="GameplaySM.c_710"></a><span class="hl lin">  710 </span>                        <span class="hl opt">{</span>
<a name="GameplaySM.c_711"></a><span class="hl lin">  711 </span>                            <span class="hl slc">// Timed out, your Responses Required Faster</span>
<a name="GameplaySM.c_712"></a><span class="hl lin">  712 </span>                            <span class="hl kwd">ChangeResponseTime</span><span class="hl opt">(</span>RESPONSE_TIME2 <span class="hl opt">-</span> RESPONSE_TIME_INCREMENT<span class="hl opt">);</span>
<a name="GameplaySM.c_713"></a><span class="hl lin">  713 </span>                        <span class="hl opt">}</span>
<a name="GameplaySM.c_714"></a><span class="hl lin">  714 </span>                <span class="hl opt">}</span>
<a name="GameplaySM.c_715"></a><span class="hl lin">  715 </span>                <span class="hl kwa">break</span><span class="hl opt">;</span>
<a name="GameplaySM.c_716"></a><span class="hl lin">  716 </span>
<a name="GameplaySM.c_717"></a><span class="hl lin">  717 </span>                <span class="hl kwa">case</span> DEFUSE <span class="hl opt">:</span>
<a name="GameplaySM.c_718"></a><span class="hl lin">  718 </span>                <span class="hl opt">{</span>
<a name="GameplaySM.c_719"></a><span class="hl lin">  719 </span>                    <span class="hl slc">// You shouldn't have pressed this, let's check</span>
<a name="GameplaySM.c_720"></a><span class="hl lin">  720 </span>                    <span class="hl kwd">EvalGameEnd</span><span class="hl opt">();</span>
<a name="GameplaySM.c_721"></a><span class="hl lin">  721 </span>
<a name="GameplaySM.c_722"></a><span class="hl lin">  722 </span>                    <span class="hl slc">// Set CurrentState to GameOver</span>
<a name="GameplaySM.c_723"></a><span class="hl lin">  723 </span>                    CurrentState <span class="hl opt">=</span> GameOver<span class="hl opt">;</span>
<a name="GameplaySM.c_724"></a><span class="hl lin">  724 </span>                <span class="hl opt">}</span>
<a name="GameplaySM.c_725"></a><span class="hl lin">  725 </span>                <span class="hl kwa">break</span><span class="hl opt">;</span>
<a name="GameplaySM.c_726"></a><span class="hl lin">  726 </span>
<a name="GameplaySM.c_727"></a><span class="hl lin">  727 </span>                <span class="hl kwa">case</span> BTOP <span class="hl opt">:</span>
<a name="GameplaySM.c_728"></a><span class="hl lin">  728 </span>                <span class="hl opt">{</span>
<a name="GameplaySM.c_729"></a><span class="hl lin">  729 </span>                    <span class="hl slc">// Batman got to the top of the building, stop motor</span>
<a name="GameplaySM.c_730"></a><span class="hl lin">  730 </span>                    ES_Event ThisEvent<span class="hl opt">;</span>
<a name="GameplaySM.c_731"></a><span class="hl lin">  731 </span>                    ThisEvent<span class="hl opt">.</span>EventType <span class="hl opt">=</span> MOTORSTOP<span class="hl opt">;</span>
<a name="GameplaySM.c_732"></a><span class="hl lin">  732 </span>                    ThisEvent<span class="hl opt">.</span>EventParam <span class="hl opt">=</span> <span class="hl num">0</span><span class="hl opt">;</span>
<a name="GameplaySM.c_733"></a><span class="hl lin">  733 </span>                    <span class="hl kwd">PostMotorSM</span><span class="hl opt">(</span>ThisEvent<span class="hl opt">);</span>
<a name="GameplaySM.c_734"></a><span class="hl lin">  734 </span>
<a name="GameplaySM.c_735"></a><span class="hl lin">  735 </span>                    <span class="hl slc">// Set CurrentState to Wait4Bomb</span>
<a name="GameplaySM.c_736"></a><span class="hl lin">  736 </span>                    CurrentState <span class="hl opt">=</span> Wait4Bomb<span class="hl opt">;</span>
<a name="GameplaySM.c_737"></a><span class="hl lin">  737 </span>                <span class="hl opt">}</span>
<a name="GameplaySM.c_738"></a><span class="hl lin">  738 </span>                <span class="hl kwa">break</span><span class="hl opt">;</span>
<a name="GameplaySM.c_739"></a><span class="hl lin">  739 </span>
<a name="GameplaySM.c_740"></a><span class="hl lin">  740 </span>                <span class="hl kwa">case</span> JOKERWIN <span class="hl opt">:</span> <span class="hl slc">// ResponseRecorded, Wait4Response, OilPause, Wait4Bomb</span>
<a name="GameplaySM.c_741"></a><span class="hl lin">  741 </span>                <span class="hl opt">{</span>
<a name="GameplaySM.c_742"></a><span class="hl lin">  742 </span>                    ES_Event ThisEvent<span class="hl opt">;</span>
<a name="GameplaySM.c_743"></a><span class="hl lin">  743 </span>                    ThisEvent<span class="hl opt">.</span>EventType <span class="hl opt">=</span> MOTORSTOP<span class="hl opt">;</span>
<a name="GameplaySM.c_744"></a><span class="hl lin">  744 </span>                    ThisEvent<span class="hl opt">.</span>EventParam <span class="hl opt">=</span> <span class="hl num">0</span><span class="hl opt">;</span>
<a name="GameplaySM.c_745"></a><span class="hl lin">  745 </span>                    <span class="hl kwd">PostMotorSM</span><span class="hl opt">(</span>ThisEvent<span class="hl opt">);</span>
<a name="GameplaySM.c_746"></a><span class="hl lin">  746 </span>
<a name="GameplaySM.c_747"></a><span class="hl lin">  747 </span>                    <span class="hl slc">// Start Celebration Timer</span>
<a name="GameplaySM.c_748"></a><span class="hl lin">  748 </span>                    <span class="hl kwd">ES_Timer_InitTimer</span><span class="hl opt">(</span>RESPONSE_TIMER<span class="hl opt">,</span> CELEBRATION_TIME<span class="hl opt">);</span>
<a name="GameplaySM.c_749"></a><span class="hl lin">  749 </span>
<a name="GameplaySM.c_750"></a><span class="hl lin">  750 </span>                    <span class="hl slc">// Set CurrentState to GameOver</span>
<a name="GameplaySM.c_751"></a><span class="hl lin">  751 </span>                    CurrentState <span class="hl opt">=</span> GameOver<span class="hl opt">;</span>
<a name="GameplaySM.c_752"></a><span class="hl lin">  752 </span>                <span class="hl opt">}</span>
<a name="GameplaySM.c_753"></a><span class="hl lin">  753 </span>                <span class="hl kwa">break</span><span class="hl opt">;</span>
<a name="GameplaySM.c_754"></a><span class="hl lin">  754 </span>
<a name="GameplaySM.c_755"></a><span class="hl lin">  755 </span>                <span class="hl kwa">case</span> JOKERLOSE <span class="hl opt">:</span> <span class="hl slc">// ResponseRecorded, Wait4Response, OilPause, Wait4Bomb</span>
<a name="GameplaySM.c_756"></a><span class="hl lin">  756 </span>                <span class="hl opt">{</span>
<a name="GameplaySM.c_757"></a><span class="hl lin">  757 </span>                    <span class="hl slc">// Stop Motor</span>
<a name="GameplaySM.c_758"></a><span class="hl lin">  758 </span>                    ES_Event ThisEvent<span class="hl opt">;</span>
<a name="GameplaySM.c_759"></a><span class="hl lin">  759 </span>                    ThisEvent<span class="hl opt">.</span>EventType <span class="hl opt">=</span> MOTORSTOP<span class="hl opt">;</span>
<a name="GameplaySM.c_760"></a><span class="hl lin">  760 </span>                    ThisEvent<span class="hl opt">.</span>EventParam <span class="hl opt">=</span> <span class="hl num">0</span><span class="hl opt">;</span>
<a name="GameplaySM.c_761"></a><span class="hl lin">  761 </span>                    <span class="hl kwd">PostMotorSM</span><span class="hl opt">(</span>ThisEvent<span class="hl opt">);</span>
<a name="GameplaySM.c_762"></a><span class="hl lin">  762 </span>
<a name="GameplaySM.c_763"></a><span class="hl lin">  763 </span>                    <span class="hl slc">// Turn on BATMAN_WIN Lights</span>
<a name="GameplaySM.c_764"></a><span class="hl lin">  764 </span>                    BWIN_LIGHTS <span class="hl opt">=</span> <span class="hl num">1</span><span class="hl opt">;</span>
<a name="GameplaySM.c_765"></a><span class="hl lin">  765 </span>
<a name="GameplaySM.c_766"></a><span class="hl lin">  766 </span>                    <span class="hl slc">// Start Celebration Timer</span>
<a name="GameplaySM.c_767"></a><span class="hl lin">  767 </span>                    <span class="hl kwd">ES_Timer_InitTimer</span><span class="hl opt">(</span>RESPONSE_TIMER<span class="hl opt">,</span> CELEBRATION_TIME<span class="hl opt">);</span>
<a name="GameplaySM.c_768"></a><span class="hl lin">  768 </span>
<a name="GameplaySM.c_769"></a><span class="hl lin">  769 </span>                    <span class="hl slc">// Set CurrentState to GameOver</span>
<a name="GameplaySM.c_770"></a><span class="hl lin">  770 </span>                    CurrentState <span class="hl opt">=</span> GameOver<span class="hl opt">;</span>
<a name="GameplaySM.c_771"></a><span class="hl lin">  771 </span>                <span class="hl opt">}</span>
<a name="GameplaySM.c_772"></a><span class="hl lin">  772 </span>                <span class="hl kwa">break</span><span class="hl opt">;</span>
<a name="GameplaySM.c_773"></a><span class="hl lin">  773 </span>
<a name="GameplaySM.c_774"></a><span class="hl lin">  774 </span>                <span class="hl kwa">case</span> OILSLICK <span class="hl opt">:</span> <span class="hl slc">// ResponseRecorded and Wait4Response</span>
<a name="GameplaySM.c_775"></a><span class="hl lin">  775 </span>                <span class="hl opt">{</span>
<a name="GameplaySM.c_776"></a><span class="hl lin">  776 </span>                    <span class="hl kwd">EvalOilAction</span><span class="hl opt">(</span> ThisEvent <span class="hl opt">);</span>
<a name="GameplaySM.c_777"></a><span class="hl lin">  777 </span>                <span class="hl opt">}</span>
<a name="GameplaySM.c_778"></a><span class="hl lin">  778 </span>                <span class="hl kwa">break</span><span class="hl opt">;</span>
<a name="GameplaySM.c_779"></a><span class="hl lin">  779 </span>
<a name="GameplaySM.c_780"></a><span class="hl lin">  780 </span>                <span class="hl opt">}</span>
<a name="GameplaySM.c_781"></a><span class="hl lin">  781 </span>            <span class="hl kwa">break</span><span class="hl opt">;</span>
<a name="GameplaySM.c_782"></a><span class="hl lin">  782 </span>
<a name="GameplaySM.c_783"></a><span class="hl lin">  783 </span>        <span class="hl kwa">case</span> OilPause <span class="hl opt">:</span>       <span class="hl slc">// If current state is OilPause</span>
<a name="GameplaySM.c_784"></a><span class="hl lin">  784 </span>
<a name="GameplaySM.c_785"></a><span class="hl lin">  785 </span>            <span class="hl kwa">switch</span> <span class="hl opt">(</span> ThisEvent<span class="hl opt">.</span>EventType <span class="hl opt">)</span>
<a name="GameplaySM.c_786"></a><span class="hl lin">  786 </span>                <span class="hl opt">{</span>
<a name="GameplaySM.c_787"></a><span class="hl lin">  787 </span>                <span class="hl kwa">case</span> ES_TIMEOUT <span class="hl opt">:</span>
<a name="GameplaySM.c_788"></a><span class="hl lin">  788 </span>                <span class="hl opt">{</span>
<a name="GameplaySM.c_789"></a><span class="hl lin">  789 </span>                    <span class="hl kwa">if</span> <span class="hl opt">(</span> ThisEvent<span class="hl opt">.</span>EventParam <span class="hl opt">==</span> RESPONSE_TIMER<span class="hl opt">)</span>
<a name="GameplaySM.c_790"></a><span class="hl lin">  790 </span>                        <span class="hl opt">{</span>
<a name="GameplaySM.c_791"></a><span class="hl lin">  791 </span>                            <span class="hl slc">//Generate Event and post to MotorSM</span>
<a name="GameplaySM.c_792"></a><span class="hl lin">  792 </span>                            ES_Event ThisEvent<span class="hl opt">;</span>
<a name="GameplaySM.c_793"></a><span class="hl lin">  793 </span>                            ThisEvent<span class="hl opt">.</span>EventType <span class="hl opt">=</span> MOTORSTART<span class="hl opt">;</span>
<a name="GameplaySM.c_794"></a><span class="hl lin">  794 </span>                            ThisEvent<span class="hl opt">.</span>EventParam <span class="hl opt">=</span> <span class="hl num">0</span><span class="hl opt">;</span>
<a name="GameplaySM.c_795"></a><span class="hl lin">  795 </span>                            <span class="hl kwd">PostMotorSM</span><span class="hl opt">(</span>ThisEvent<span class="hl opt">);</span>
<a name="GameplaySM.c_796"></a><span class="hl lin">  796 </span>
<a name="GameplaySM.c_797"></a><span class="hl lin">  797 </span>                            <span class="hl slc">// Change the current state</span>
<a name="GameplaySM.c_798"></a><span class="hl lin">  798 </span>                            CurrentState <span class="hl opt">=</span> Wait4Response<span class="hl opt">;</span>
<a name="GameplaySM.c_799"></a><span class="hl lin">  799 </span>
<a name="GameplaySM.c_800"></a><span class="hl lin">  800 </span>                            <span class="hl slc">// Generate an action to prompt the user</span>
<a name="GameplaySM.c_801"></a><span class="hl lin">  801 </span>                            <span class="hl kwd">GenerateNewAction</span><span class="hl opt">();</span>
<a name="GameplaySM.c_802"></a><span class="hl lin">  802 </span>                        <span class="hl opt">}</span>
<a name="GameplaySM.c_803"></a><span class="hl lin">  803 </span>                <span class="hl opt">}</span>
<a name="GameplaySM.c_804"></a><span class="hl lin">  804 </span>                <span class="hl kwa">break</span><span class="hl opt">;</span>
<a name="GameplaySM.c_805"></a><span class="hl lin">  805 </span>
<a name="GameplaySM.c_806"></a><span class="hl lin">  806 </span>                <span class="hl kwa">case</span> PEDAL <span class="hl opt">:</span>
<a name="GameplaySM.c_807"></a><span class="hl lin">  807 </span>                <span class="hl opt">{</span>
<a name="GameplaySM.c_808"></a><span class="hl lin">  808 </span>                    <span class="hl slc">// Start Updating PedalArray based on pedal events</span>
<a name="GameplaySM.c_809"></a><span class="hl lin">  809 </span>                    <span class="hl kwd">BatmanPedal</span><span class="hl opt">(</span>ThisEvent<span class="hl opt">.</span>EventParam<span class="hl opt">);</span>
<a name="GameplaySM.c_810"></a><span class="hl lin">  810 </span>
<a name="GameplaySM.c_811"></a><span class="hl lin">  811 </span>                    <span class="hl slc">// Change the NextAction State</span>
<a name="GameplaySM.c_812"></a><span class="hl lin">  812 </span>                    <span class="hl kwd">ChangeAction</span><span class="hl opt">();</span>
<a name="GameplaySM.c_813"></a><span class="hl lin">  813 </span>                <span class="hl opt">}</span>
<a name="GameplaySM.c_814"></a><span class="hl lin">  814 </span>                <span class="hl kwa">break</span><span class="hl opt">;</span>
<a name="GameplaySM.c_815"></a><span class="hl lin">  815 </span>
<a name="GameplaySM.c_816"></a><span class="hl lin">  816 </span>                <span class="hl kwa">case</span> DEFUSE <span class="hl opt">:</span>
<a name="GameplaySM.c_817"></a><span class="hl lin">  817 </span>                <span class="hl opt">{</span>
<a name="GameplaySM.c_818"></a><span class="hl lin">  818 </span>                    <span class="hl kwd">EvalGameEnd</span><span class="hl opt">( );</span>
<a name="GameplaySM.c_819"></a><span class="hl lin">  819 </span>
<a name="GameplaySM.c_820"></a><span class="hl lin">  820 </span>                    <span class="hl slc">// Set CurrentState to GameOver</span>
<a name="GameplaySM.c_821"></a><span class="hl lin">  821 </span>                    CurrentState <span class="hl opt">=</span> GameOver<span class="hl opt">;</span>
<a name="GameplaySM.c_822"></a><span class="hl lin">  822 </span>                <span class="hl opt">}</span>
<a name="GameplaySM.c_823"></a><span class="hl lin">  823 </span>                <span class="hl kwa">break</span><span class="hl opt">;</span>
<a name="GameplaySM.c_824"></a><span class="hl lin">  824 </span>
<a name="GameplaySM.c_825"></a><span class="hl lin">  825 </span>                <span class="hl kwa">case</span> JOKERWIN <span class="hl opt">:</span> <span class="hl slc">// ResponseRecorded, Wait4Response, OilPause, Wait4Bomb</span>
<a name="GameplaySM.c_826"></a><span class="hl lin">  826 </span>                <span class="hl opt">{</span>
<a name="GameplaySM.c_827"></a><span class="hl lin">  827 </span>                    ES_Event ThisEvent<span class="hl opt">;</span>
<a name="GameplaySM.c_828"></a><span class="hl lin">  828 </span>                    ThisEvent<span class="hl opt">.</span>EventType <span class="hl opt">=</span> MOTORSTOP<span class="hl opt">;</span>
<a name="GameplaySM.c_829"></a><span class="hl lin">  829 </span>                    ThisEvent<span class="hl opt">.</span>EventParam <span class="hl opt">=</span> <span class="hl num">0</span><span class="hl opt">;</span>
<a name="GameplaySM.c_830"></a><span class="hl lin">  830 </span>                    <span class="hl kwd">PostMotorSM</span><span class="hl opt">(</span>ThisEvent<span class="hl opt">);</span>
<a name="GameplaySM.c_831"></a><span class="hl lin">  831 </span>                    <span class="hl kwd">ES_Timer_InitTimer</span><span class="hl opt">(</span>RESPONSE_TIMER<span class="hl opt">,</span> CELEBRATION_TIME<span class="hl opt">);</span>
<a name="GameplaySM.c_832"></a><span class="hl lin">  832 </span>
<a name="GameplaySM.c_833"></a><span class="hl lin">  833 </span>                    <span class="hl slc">// Ensure BATWIN_LIGHTS Off</span>
<a name="GameplaySM.c_834"></a><span class="hl lin">  834 </span>                    BWIN_LIGHTS <span class="hl opt">=</span> OFF<span class="hl opt">;</span>
<a name="GameplaySM.c_835"></a><span class="hl lin">  835 </span>
<a name="GameplaySM.c_836"></a><span class="hl lin">  836 </span>                    <span class="hl slc">// Set CurrentState to GameOver</span>
<a name="GameplaySM.c_837"></a><span class="hl lin">  837 </span>                    CurrentState <span class="hl opt">=</span> GameOver<span class="hl opt">;</span>
<a name="GameplaySM.c_838"></a><span class="hl lin">  838 </span>                <span class="hl opt">}</span>
<a name="GameplaySM.c_839"></a><span class="hl lin">  839 </span>                <span class="hl kwa">break</span><span class="hl opt">;</span>
<a name="GameplaySM.c_840"></a><span class="hl lin">  840 </span>
<a name="GameplaySM.c_841"></a><span class="hl lin">  841 </span>                <span class="hl kwa">case</span> JOKERLOSE <span class="hl opt">:</span> <span class="hl slc">// ResponseRecorded, Wait4Response, OilPause, Wait4Bomb</span>
<a name="GameplaySM.c_842"></a><span class="hl lin">  842 </span>                <span class="hl opt">{</span>
<a name="GameplaySM.c_843"></a><span class="hl lin">  843 </span>                    <span class="hl slc">// Stop Motor</span>
<a name="GameplaySM.c_844"></a><span class="hl lin">  844 </span>                    ES_Event ThisEvent<span class="hl opt">;</span>
<a name="GameplaySM.c_845"></a><span class="hl lin">  845 </span>                    ThisEvent<span class="hl opt">.</span>EventType <span class="hl opt">=</span> MOTORSTOP<span class="hl opt">;</span>
<a name="GameplaySM.c_846"></a><span class="hl lin">  846 </span>                    ThisEvent<span class="hl opt">.</span>EventParam <span class="hl opt">=</span> <span class="hl num">0</span><span class="hl opt">;</span>
<a name="GameplaySM.c_847"></a><span class="hl lin">  847 </span>                    <span class="hl kwd">PostMotorSM</span><span class="hl opt">(</span>ThisEvent<span class="hl opt">);</span>
<a name="GameplaySM.c_848"></a><span class="hl lin">  848 </span>
<a name="GameplaySM.c_849"></a><span class="hl lin">  849 </span>                    <span class="hl slc">// Turn on BATMANWIN_LIGHTS</span>
<a name="GameplaySM.c_850"></a><span class="hl lin">  850 </span>                    BWIN_LIGHTS <span class="hl opt">=</span> <span class="hl num">1</span><span class="hl opt">;</span>
<a name="GameplaySM.c_851"></a><span class="hl lin">  851 </span>
<a name="GameplaySM.c_852"></a><span class="hl lin">  852 </span>                    <span class="hl slc">//Start Celebration Timer</span>
<a name="GameplaySM.c_853"></a><span class="hl lin">  853 </span>                    <span class="hl kwd">ES_Timer_InitTimer</span><span class="hl opt">(</span>RESPONSE_TIMER<span class="hl opt">,</span> CELEBRATION_TIME<span class="hl opt">);</span>
<a name="GameplaySM.c_854"></a><span class="hl lin">  854 </span>
<a name="GameplaySM.c_855"></a><span class="hl lin">  855 </span>                    <span class="hl slc">// Set CurrentState to GameOver</span>
<a name="GameplaySM.c_856"></a><span class="hl lin">  856 </span>                    CurrentState <span class="hl opt">=</span> GameOver<span class="hl opt">;</span>
<a name="GameplaySM.c_857"></a><span class="hl lin">  857 </span>                <span class="hl opt">}</span>
<a name="GameplaySM.c_858"></a><span class="hl lin">  858 </span>                <span class="hl kwa">break</span><span class="hl opt">;</span>
<a name="GameplaySM.c_859"></a><span class="hl lin">  859 </span>                <span class="hl opt">}</span>                           <span class="hl slc">// end switch on CurrentEvent</span>
<a name="GameplaySM.c_860"></a><span class="hl lin">  860 </span>            <span class="hl kwa">break</span><span class="hl opt">;</span>
<a name="GameplaySM.c_861"></a><span class="hl lin">  861 </span>
<a name="GameplaySM.c_862"></a><span class="hl lin">  862 </span>        <span class="hl kwa">case</span> Wait4Bomb <span class="hl opt">:</span>       <span class="hl slc">// If current state is state one</span>
<a name="GameplaySM.c_863"></a><span class="hl lin">  863 </span>
<a name="GameplaySM.c_864"></a><span class="hl lin">  864 </span>            <span class="hl kwa">switch</span> <span class="hl opt">(</span> ThisEvent<span class="hl opt">.</span>EventType <span class="hl opt">)</span>
<a name="GameplaySM.c_865"></a><span class="hl lin">  865 </span>                <span class="hl opt">{</span>
<a name="GameplaySM.c_866"></a><span class="hl lin">  866 </span>                <span class="hl kwa">case</span> DEFUSE <span class="hl opt">:</span>
<a name="GameplaySM.c_867"></a><span class="hl lin">  867 </span>                <span class="hl opt">{</span>
<a name="GameplaySM.c_868"></a><span class="hl lin">  868 </span>                    <span class="hl slc">// Call function to evaluate who wins</span>
<a name="GameplaySM.c_869"></a><span class="hl lin">  869 </span>                    <span class="hl kwd">EvalGameEnd</span><span class="hl opt">();</span>
<a name="GameplaySM.c_870"></a><span class="hl lin">  870 </span>
<a name="GameplaySM.c_871"></a><span class="hl lin">  871 </span>                    <span class="hl slc">// Set CurrentState to GameOver</span>
<a name="GameplaySM.c_872"></a><span class="hl lin">  872 </span>                    CurrentState <span class="hl opt">=</span> GameOver<span class="hl opt">;</span>
<a name="GameplaySM.c_873"></a><span class="hl lin">  873 </span>                <span class="hl opt">}</span>
<a name="GameplaySM.c_874"></a><span class="hl lin">  874 </span>                <span class="hl kwa">break</span><span class="hl opt">;</span>
<a name="GameplaySM.c_875"></a><span class="hl lin">  875 </span>
<a name="GameplaySM.c_876"></a><span class="hl lin">  876 </span>                <span class="hl kwa">case</span> GAME_END <span class="hl opt">:</span> <span class="hl slc">// ResponseRecorded, Wait4Response, OilPause, Wait4Bomb</span>
<a name="GameplaySM.c_877"></a><span class="hl lin">  877 </span>                <span class="hl opt">{</span>
<a name="GameplaySM.c_878"></a><span class="hl lin">  878 </span>                    <span class="hl slc">// Time Over and go to reset</span>
<a name="GameplaySM.c_879"></a><span class="hl lin">  879 </span>                    ES_Event ThisEvent<span class="hl opt">;</span>
<a name="GameplaySM.c_880"></a><span class="hl lin">  880 </span>                    ThisEvent<span class="hl opt">.</span>EventType <span class="hl opt">=</span> MOTORREVERSE<span class="hl opt">;</span>
<a name="GameplaySM.c_881"></a><span class="hl lin">  881 </span>                    ThisEvent<span class="hl opt">.</span>EventParam <span class="hl opt">=</span> <span class="hl num">0</span><span class="hl opt">;</span>
<a name="GameplaySM.c_882"></a><span class="hl lin">  882 </span>                    <span class="hl kwd">PostMotorSM</span><span class="hl opt">(</span>ThisEvent<span class="hl opt">);</span>
<a name="GameplaySM.c_883"></a><span class="hl lin">  883 </span>
<a name="GameplaySM.c_884"></a><span class="hl lin">  884 </span>                    <span class="hl slc">// Ensura BATMANWIN_LIGHTS Off</span>
<a name="GameplaySM.c_885"></a><span class="hl lin">  885 </span>                    BWIN_LIGHTS <span class="hl opt">=</span> <span class="hl num">0</span><span class="hl opt">;</span>
<a name="GameplaySM.c_886"></a><span class="hl lin">  886 </span>
<a name="GameplaySM.c_887"></a><span class="hl lin">  887 </span>                    <span class="hl slc">// Set CurrentState to Resetting</span>
<a name="GameplaySM.c_888"></a><span class="hl lin">  888 </span>                    CurrentState <span class="hl opt">=</span> Resetting<span class="hl opt">;</span>
<a name="GameplaySM.c_889"></a><span class="hl lin">  889 </span>                <span class="hl opt">}</span>
<a name="GameplaySM.c_890"></a><span class="hl lin">  890 </span>                <span class="hl kwa">break</span><span class="hl opt">;</span>
<a name="GameplaySM.c_891"></a><span class="hl lin">  891 </span>
<a name="GameplaySM.c_892"></a><span class="hl lin">  892 </span>                <span class="hl kwa">case</span> JOKERWIN <span class="hl opt">:</span> <span class="hl slc">// ResponseRecorded, Wait4Response, OilPause, Wait4Bomb</span>
<a name="GameplaySM.c_893"></a><span class="hl lin">  893 </span>                <span class="hl opt">{</span>
<a name="GameplaySM.c_894"></a><span class="hl lin">  894 </span>                    ES_Event ThisEvent<span class="hl opt">;</span>
<a name="GameplaySM.c_895"></a><span class="hl lin">  895 </span>                    ThisEvent<span class="hl opt">.</span>EventType <span class="hl opt">=</span> MOTORSTOP<span class="hl opt">;</span>
<a name="GameplaySM.c_896"></a><span class="hl lin">  896 </span>                    ThisEvent<span class="hl opt">.</span>EventParam <span class="hl opt">=</span> <span class="hl num">0</span><span class="hl opt">;</span>
<a name="GameplaySM.c_897"></a><span class="hl lin">  897 </span>                    <span class="hl kwd">PostMotorSM</span><span class="hl opt">(</span>ThisEvent<span class="hl opt">);</span>
<a name="GameplaySM.c_898"></a><span class="hl lin">  898 </span>
<a name="GameplaySM.c_899"></a><span class="hl lin">  899 </span>                    <span class="hl slc">// Start Celebration Timer</span>
<a name="GameplaySM.c_900"></a><span class="hl lin">  900 </span>                    <span class="hl kwd">ES_Timer_InitTimer</span><span class="hl opt">(</span>RESPONSE_TIMER<span class="hl opt">,</span> CELEBRATION_TIME<span class="hl opt">);</span>
<a name="GameplaySM.c_901"></a><span class="hl lin">  901 </span>
<a name="GameplaySM.c_902"></a><span class="hl lin">  902 </span>                    <span class="hl slc">// Set CurrentState to GameOver</span>
<a name="GameplaySM.c_903"></a><span class="hl lin">  903 </span>                    CurrentState <span class="hl opt">=</span> GameOver<span class="hl opt">;</span>
<a name="GameplaySM.c_904"></a><span class="hl lin">  904 </span>                <span class="hl opt">}</span>
<a name="GameplaySM.c_905"></a><span class="hl lin">  905 </span>                <span class="hl kwa">break</span><span class="hl opt">;</span>
<a name="GameplaySM.c_906"></a><span class="hl lin">  906 </span>
<a name="GameplaySM.c_907"></a><span class="hl lin">  907 </span>                <span class="hl kwa">case</span> JOKERLOSE <span class="hl opt">:</span> <span class="hl slc">// ResponseRecorded, Wait4Response, OilPause, Wait4Bomb</span>
<a name="GameplaySM.c_908"></a><span class="hl lin">  908 </span>                <span class="hl opt">{</span>
<a name="GameplaySM.c_909"></a><span class="hl lin">  909 </span>                    <span class="hl slc">//Start Celebration Timer</span>
<a name="GameplaySM.c_910"></a><span class="hl lin">  910 </span>                    ES_Event ThisEvent<span class="hl opt">;</span>
<a name="GameplaySM.c_911"></a><span class="hl lin">  911 </span>                    ThisEvent<span class="hl opt">.</span>EventType <span class="hl opt">=</span> MOTORSTOP<span class="hl opt">;</span>
<a name="GameplaySM.c_912"></a><span class="hl lin">  912 </span>                    ThisEvent<span class="hl opt">.</span>EventParam <span class="hl opt">=</span> <span class="hl num">0</span><span class="hl opt">;</span>
<a name="GameplaySM.c_913"></a><span class="hl lin">  913 </span>                    <span class="hl kwd">PostMotorSM</span><span class="hl opt">(</span>ThisEvent<span class="hl opt">);</span>
<a name="GameplaySM.c_914"></a><span class="hl lin">  914 </span>
<a name="GameplaySM.c_915"></a><span class="hl lin">  915 </span>                    <span class="hl slc">// Start Celebration Timer</span>
<a name="GameplaySM.c_916"></a><span class="hl lin">  916 </span>                    <span class="hl kwd">ES_Timer_InitTimer</span><span class="hl opt">(</span>RESPONSE_TIMER<span class="hl opt">,</span> CELEBRATION_TIME<span class="hl opt">);</span>
<a name="GameplaySM.c_917"></a><span class="hl lin">  917 </span>
<a name="GameplaySM.c_918"></a><span class="hl lin">  918 </span>                    <span class="hl slc">// Turn On BATMANWIN_LIGHTS</span>
<a name="GameplaySM.c_919"></a><span class="hl lin">  919 </span>                    BWIN_LIGHTS <span class="hl opt">=</span> <span class="hl num">1</span><span class="hl opt">;</span>
<a name="GameplaySM.c_920"></a><span class="hl lin">  920 </span>
<a name="GameplaySM.c_921"></a><span class="hl lin">  921 </span>                    <span class="hl slc">// Set CurrentState to GameOver</span>
<a name="GameplaySM.c_922"></a><span class="hl lin">  922 </span>                    CurrentState <span class="hl opt">=</span> GameOver<span class="hl opt">;</span>
<a name="GameplaySM.c_923"></a><span class="hl lin">  923 </span>                <span class="hl opt">}</span>
<a name="GameplaySM.c_924"></a><span class="hl lin">  924 </span>                <span class="hl kwa">break</span><span class="hl opt">;</span>
<a name="GameplaySM.c_925"></a><span class="hl lin">  925 </span>
<a name="GameplaySM.c_926"></a><span class="hl lin">  926 </span>                <span class="hl opt">}</span>
<a name="GameplaySM.c_927"></a><span class="hl lin">  927 </span>            <span class="hl kwa">break</span><span class="hl opt">;</span>
<a name="GameplaySM.c_928"></a><span class="hl lin">  928 </span>
<a name="GameplaySM.c_929"></a><span class="hl lin">  929 </span>        <span class="hl kwa">case</span> GameOver <span class="hl opt">:</span>
<a name="GameplaySM.c_930"></a><span class="hl lin">  930 </span>
<a name="GameplaySM.c_931"></a><span class="hl lin">  931 </span>            <span class="hl kwa">switch</span> <span class="hl opt">(</span> ThisEvent<span class="hl opt">.</span>EventType <span class="hl opt">)</span>
<a name="GameplaySM.c_932"></a><span class="hl lin">  932 </span>                <span class="hl opt">{</span>
<a name="GameplaySM.c_933"></a><span class="hl lin">  933 </span>                <span class="hl kwa">case</span> ES_TIMEOUT <span class="hl opt">:</span>
<a name="GameplaySM.c_934"></a><span class="hl lin">  934 </span>                <span class="hl opt">{</span>
<a name="GameplaySM.c_935"></a><span class="hl lin">  935 </span>                    <span class="hl kwa">if</span> <span class="hl opt">(</span>ThisEvent<span class="hl opt">.</span>EventParam <span class="hl opt">==</span> RESPONSE_TIMER<span class="hl opt">)</span>
<a name="GameplaySM.c_936"></a><span class="hl lin">  936 </span>                        <span class="hl opt">{</span>
<a name="GameplaySM.c_937"></a><span class="hl lin">  937 </span>                            <span class="hl slc">// Eval if Batman is at the bottom already</span>
<a name="GameplaySM.c_938"></a><span class="hl lin">  938 </span>                            <span class="hl kwa">if</span> <span class="hl opt">(</span><span class="hl kwd">GetPseudoPortState</span><span class="hl opt">(</span>BOTTOM_LIMIT_POS<span class="hl opt">) !=</span> LO<span class="hl opt">)</span>
<a name="GameplaySM.c_939"></a><span class="hl lin">  939 </span>                                <span class="hl opt">{</span>
<a name="GameplaySM.c_940"></a><span class="hl lin">  940 </span>                                    ES_Event ThisEvent<span class="hl opt">;</span>
<a name="GameplaySM.c_941"></a><span class="hl lin">  941 </span>                                    ThisEvent<span class="hl opt">.</span>EventType <span class="hl opt">=</span> MOTORREVERSE<span class="hl opt">;</span>
<a name="GameplaySM.c_942"></a><span class="hl lin">  942 </span>                                    ThisEvent<span class="hl opt">.</span>EventParam <span class="hl opt">=</span> <span class="hl num">0</span><span class="hl opt">;</span>
<a name="GameplaySM.c_943"></a><span class="hl lin">  943 </span>                                    <span class="hl kwd">PostMotorSM</span><span class="hl opt">(</span>ThisEvent<span class="hl opt">);</span>
<a name="GameplaySM.c_944"></a><span class="hl lin">  944 </span>
<a name="GameplaySM.c_945"></a><span class="hl lin">  945 </span>                                    <span class="hl slc">// Set CurrentState to Resetting</span>
<a name="GameplaySM.c_946"></a><span class="hl lin">  946 </span>                                    CurrentState <span class="hl opt">=</span> Resetting<span class="hl opt">;</span>
<a name="GameplaySM.c_947"></a><span class="hl lin">  947 </span>                                <span class="hl opt">}</span>
<a name="GameplaySM.c_948"></a><span class="hl lin">  948 </span>                            <span class="hl kwa">else</span>
<a name="GameplaySM.c_949"></a><span class="hl lin">  949 </span>                                <span class="hl opt">{</span>
<a name="GameplaySM.c_950"></a><span class="hl lin">  950 </span>                                    <span class="hl slc">// Set CurrentState to LockDown</span>
<a name="GameplaySM.c_951"></a><span class="hl lin">  951 </span>                                    CurrentState <span class="hl opt">=</span> LockDown<span class="hl opt">;</span>
<a name="GameplaySM.c_952"></a><span class="hl lin">  952 </span>                                <span class="hl opt">}</span>
<a name="GameplaySM.c_953"></a><span class="hl lin">  953 </span>
<a name="GameplaySM.c_954"></a><span class="hl lin">  954 </span>                        <span class="hl opt">}</span>
<a name="GameplaySM.c_955"></a><span class="hl lin">  955 </span>                <span class="hl opt">}</span>
<a name="GameplaySM.c_956"></a><span class="hl lin">  956 </span>                <span class="hl kwa">break</span><span class="hl opt">;</span>
<a name="GameplaySM.c_957"></a><span class="hl lin">  957 </span>
<a name="GameplaySM.c_958"></a><span class="hl lin">  958 </span>                <span class="hl opt">}</span>                           <span class="hl slc">// end switch on CurrentEvent</span>
<a name="GameplaySM.c_959"></a><span class="hl lin">  959 </span>            <span class="hl kwa">break</span><span class="hl opt">;</span>
<a name="GameplaySM.c_960"></a><span class="hl lin">  960 </span>
<a name="GameplaySM.c_961"></a><span class="hl lin">  961 </span>        <span class="hl kwa">case</span> Resetting <span class="hl opt">:</span>       <span class="hl slc">// If current state is state one</span>
<a name="GameplaySM.c_962"></a><span class="hl lin">  962 </span>            <span class="hl kwa">switch</span> <span class="hl opt">(</span> ThisEvent<span class="hl opt">.</span>EventType <span class="hl opt">)</span>
<a name="GameplaySM.c_963"></a><span class="hl lin">  963 </span>                <span class="hl opt">{</span>
<a name="GameplaySM.c_964"></a><span class="hl lin">  964 </span>                <span class="hl kwa">case</span> BBOT <span class="hl opt">:</span>
<a name="GameplaySM.c_965"></a><span class="hl lin">  965 </span>                <span class="hl opt">{</span>
<a name="GameplaySM.c_966"></a><span class="hl lin">  966 </span>                    ES_Event ThisEvent<span class="hl opt">;</span>
<a name="GameplaySM.c_967"></a><span class="hl lin">  967 </span>                    ThisEvent<span class="hl opt">.</span>EventType <span class="hl opt">=</span> MOTORSTOP<span class="hl opt">;</span>
<a name="GameplaySM.c_968"></a><span class="hl lin">  968 </span>                    ThisEvent<span class="hl opt">.</span>EventParam <span class="hl opt">=</span> <span class="hl num">0</span><span class="hl opt">;</span>
<a name="GameplaySM.c_969"></a><span class="hl lin">  969 </span>                    <span class="hl kwd">PostMotorSM</span><span class="hl opt">(</span>ThisEvent<span class="hl opt">);</span>
<a name="GameplaySM.c_970"></a><span class="hl lin">  970 </span>
<a name="GameplaySM.c_971"></a><span class="hl lin">  971 </span>                    BWIN_LIGHTS <span class="hl opt">=</span> <span class="hl num">0</span><span class="hl opt">;</span> <span class="hl slc">//turn lights off</span>
<a name="GameplaySM.c_972"></a><span class="hl lin">  972 </span>                    <span class="hl kwd">BatmanPedal</span><span class="hl opt">(</span>OFF<span class="hl opt">);</span>
<a name="GameplaySM.c_973"></a><span class="hl lin">  973 </span>                    <span class="hl kwd">BatmanSide</span><span class="hl opt">(</span>OFF<span class="hl opt">);</span>
<a name="GameplaySM.c_974"></a><span class="hl lin">  974 </span>                    <span class="hl kwd">BatmanOil</span><span class="hl opt">(</span>OFF<span class="hl opt">);</span>
<a name="GameplaySM.c_975"></a><span class="hl lin">  975 </span>                    <span class="hl kwd">BatmanLaser</span><span class="hl opt">(</span>OFF<span class="hl opt">);</span>
<a name="GameplaySM.c_976"></a><span class="hl lin">  976 </span>
<a name="GameplaySM.c_977"></a><span class="hl lin">  977 </span>                    CurrentState <span class="hl opt">=</span> LockDown<span class="hl opt">;</span>
<a name="GameplaySM.c_978"></a><span class="hl lin">  978 </span>                <span class="hl opt">}</span>
<a name="GameplaySM.c_979"></a><span class="hl lin">  979 </span>                <span class="hl kwa">break</span><span class="hl opt">;</span>
<a name="GameplaySM.c_980"></a><span class="hl lin">  980 </span>
<a name="GameplaySM.c_981"></a><span class="hl lin">  981 </span>                <span class="hl opt">}</span>                           <span class="hl slc">// end switch on CurrentEvent</span>
<a name="GameplaySM.c_982"></a><span class="hl lin">  982 </span>            <span class="hl kwa">break</span><span class="hl opt">;</span>
<a name="GameplaySM.c_983"></a><span class="hl lin">  983 </span>
<a name="GameplaySM.c_984"></a><span class="hl lin">  984 </span>        <span class="hl opt">}</span>                                   <span class="hl slc">// end switch on Current State</span>
<a name="GameplaySM.c_985"></a><span class="hl lin">  985 </span>    <span class="hl kwa">return</span> ReturnEvent<span class="hl opt">;</span>
<a name="GameplaySM.c_986"></a><span class="hl lin">  986 </span><span class="hl opt">}</span>
<a name="GameplaySM.c_987"></a><span class="hl lin">  987 </span>
<a name="GameplaySM.c_988"></a><span class="hl lin">  988 </span><span class="hl com">/****************************************************************************</span>
<a name="GameplaySM.c_989"></a><span class="hl lin">  989 </span><span class="hl com"> Function</span>
<a name="GameplaySM.c_990"></a><span class="hl lin">  990 </span><span class="hl com">     QueryGameplaySM</span>
<a name="GameplaySM.c_991"></a><span class="hl lin">  991 </span><span class="hl com"></span>
<a name="GameplaySM.c_992"></a><span class="hl lin">  992 </span><span class="hl com"> Parameters</span>
<a name="GameplaySM.c_993"></a><span class="hl lin">  993 </span><span class="hl com">     None</span>
<a name="GameplaySM.c_994"></a><span class="hl lin">  994 </span><span class="hl com"></span>
<a name="GameplaySM.c_995"></a><span class="hl lin">  995 </span><span class="hl com"> Returns</span>
<a name="GameplaySM.c_996"></a><span class="hl lin">  996 </span><span class="hl com">     GameplayState_t The current state of the Gameplay state machine</span>
<a name="GameplaySM.c_997"></a><span class="hl lin">  997 </span><span class="hl com"></span>
<a name="GameplaySM.c_998"></a><span class="hl lin">  998 </span><span class="hl com"> Description</span>
<a name="GameplaySM.c_999"></a><span class="hl lin">  999 </span><span class="hl com">     returns the current state of the Gameplay state machine</span>
<a name="GameplaySM.c_1000"></a><span class="hl lin"> 1000 </span><span class="hl com"> Notes</span>
<a name="GameplaySM.c_1001"></a><span class="hl lin"> 1001 </span><span class="hl com"></span>
<a name="GameplaySM.c_1002"></a><span class="hl lin"> 1002 </span><span class="hl com"> Author</span>
<a name="GameplaySM.c_1003"></a><span class="hl lin"> 1003 </span><span class="hl com">     J. Edward Carryer, 10/23/11, 19:21</span>
<a name="GameplaySM.c_1004"></a><span class="hl lin"> 1004 </span><span class="hl com">****************************************************************************/</span>
<a name="GameplaySM.c_1005"></a><span class="hl lin"> 1005 </span>GameplayState_t <span class="hl kwd">QueryGameplaySM</span> <span class="hl opt">(</span> <span class="hl kwb">void</span> <span class="hl opt">)</span>
<a name="GameplaySM.c_1006"></a><span class="hl lin"> 1006 </span><span class="hl opt">{</span>
<a name="GameplaySM.c_1007"></a><span class="hl lin"> 1007 </span>    <span class="hl kwa">return</span><span class="hl opt">(</span>CurrentState<span class="hl opt">);</span>
<a name="GameplaySM.c_1008"></a><span class="hl lin"> 1008 </span><span class="hl opt">}</span>
<a name="GameplaySM.c_1009"></a><span class="hl lin"> 1009 </span>
<a name="GameplaySM.c_1010"></a><span class="hl lin"> 1010 </span><span class="hl com">/***************************************************************************</span>
<a name="GameplaySM.c_1011"></a><span class="hl lin"> 1011 </span><span class="hl com"> private functions</span>
<a name="GameplaySM.c_1012"></a><span class="hl lin"> 1012 </span><span class="hl com"> ***************************************************************************/</span>
<a name="GameplaySM.c_1013"></a><span class="hl lin"> 1013 </span>
<a name="GameplaySM.c_1014"></a><span class="hl lin"> 1014 </span>
<a name="GameplaySM.c_1015"></a><span class="hl lin"> 1015 </span><span class="hl com">/****************************************************************************</span>
<a name="GameplaySM.c_1016"></a><span class="hl lin"> 1016 </span><span class="hl com"> Function</span>
<a name="GameplaySM.c_1017"></a><span class="hl lin"> 1017 </span><span class="hl com">     GenerateNewAction</span>
<a name="GameplaySM.c_1018"></a><span class="hl lin"> 1018 </span><span class="hl com"></span>
<a name="GameplaySM.c_1019"></a><span class="hl lin"> 1019 </span><span class="hl com"> Parameters</span>
<a name="GameplaySM.c_1020"></a><span class="hl lin"> 1020 </span><span class="hl com">     None</span>
<a name="GameplaySM.c_1021"></a><span class="hl lin"> 1021 </span><span class="hl com"></span>
<a name="GameplaySM.c_1022"></a><span class="hl lin"> 1022 </span><span class="hl com"> Returns</span>
<a name="GameplaySM.c_1023"></a><span class="hl lin"> 1023 </span><span class="hl com">     Nothing</span>
<a name="GameplaySM.c_1024"></a><span class="hl lin"> 1024 </span><span class="hl com"></span>
<a name="GameplaySM.c_1025"></a><span class="hl lin"> 1025 </span><span class="hl com"> Description</span>
<a name="GameplaySM.c_1026"></a><span class="hl lin"> 1026 </span><span class="hl com">     This function generates either a SideButtonAction or a LaserAction for the</span>
<a name="GameplaySM.c_1027"></a><span class="hl lin"> 1027 </span><span class="hl com">     user to respond to. It uses the ES_Timer_GetTime() function to randomize</span>
<a name="GameplaySM.c_1028"></a><span class="hl lin"> 1028 </span><span class="hl com">     the action generation process. An odd number represents a SideButtonAction</span>
<a name="GameplaySM.c_1029"></a><span class="hl lin"> 1029 </span><span class="hl com">     and an even number represents a LaserAction.</span>
<a name="GameplaySM.c_1030"></a><span class="hl lin"> 1030 </span><span class="hl com"></span>
<a name="GameplaySM.c_1031"></a><span class="hl lin"> 1031 </span><span class="hl com"> Notes</span>
<a name="GameplaySM.c_1032"></a><span class="hl lin"> 1032 </span><span class="hl com"></span>
<a name="GameplaySM.c_1033"></a><span class="hl lin"> 1033 </span><span class="hl com"> Author</span>
<a name="GameplaySM.c_1034"></a><span class="hl lin"> 1034 </span><span class="hl com">     B. Jennings 11/20/2012</span>
<a name="GameplaySM.c_1035"></a><span class="hl lin"> 1035 </span><span class="hl com">****************************************************************************/</span>
<a name="GameplaySM.c_1036"></a><span class="hl lin"> 1036 </span><span class="hl kwb">void</span> <span class="hl kwd">GenerateNewAction</span><span class="hl opt">(</span><span class="hl kwb">void</span><span class="hl opt">)</span>
<a name="GameplaySM.c_1037"></a><span class="hl lin"> 1037 </span><span class="hl opt">{</span>
<a name="GameplaySM.c_1038"></a><span class="hl lin"> 1038 </span>
<a name="GameplaySM.c_1039"></a><span class="hl lin"> 1039 </span>    <span class="hl slc">// Turn off user prompt lights</span>
<a name="GameplaySM.c_1040"></a><span class="hl lin"> 1040 </span>    <span class="hl kwd">BatmanSide</span><span class="hl opt">(</span>OFF<span class="hl opt">);</span>
<a name="GameplaySM.c_1041"></a><span class="hl lin"> 1041 </span>    <span class="hl kwd">BatmanLaser</span><span class="hl opt">(</span>OFF<span class="hl opt">);</span>
<a name="GameplaySM.c_1042"></a><span class="hl lin"> 1042 </span>
<a name="GameplaySM.c_1043"></a><span class="hl lin"> 1043 </span>    <span class="hl kwa">if</span> <span class="hl opt">(</span>NextAction <span class="hl opt">&amp;</span> BIT1LO<span class="hl opt">)</span>
<a name="GameplaySM.c_1044"></a><span class="hl lin"> 1044 </span>        <span class="hl opt">{</span>
<a name="GameplaySM.c_1045"></a><span class="hl lin"> 1045 </span>            <span class="hl slc">// Set current action based on NextAction variable</span>
<a name="GameplaySM.c_1046"></a><span class="hl lin"> 1046 </span>            CurrentAction <span class="hl opt">=</span> SIDE_BUTTON_ACTION<span class="hl opt">;</span>
<a name="GameplaySM.c_1047"></a><span class="hl lin"> 1047 </span>            <span class="hl slc">// Turn on indicator light</span>
<a name="GameplaySM.c_1048"></a><span class="hl lin"> 1048 </span>            <span class="hl kwd">BatmanSide</span><span class="hl opt">(</span>SideON<span class="hl opt">);</span>
<a name="GameplaySM.c_1049"></a><span class="hl lin"> 1049 </span>        <span class="hl opt">}</span>
<a name="GameplaySM.c_1050"></a><span class="hl lin"> 1050 </span>
<a name="GameplaySM.c_1051"></a><span class="hl lin"> 1051 </span>    <span class="hl kwa">else</span>
<a name="GameplaySM.c_1052"></a><span class="hl lin"> 1052 </span>        <span class="hl opt">{</span>
<a name="GameplaySM.c_1053"></a><span class="hl lin"> 1053 </span>            <span class="hl slc">// Set current action based on NextAction variable</span>
<a name="GameplaySM.c_1054"></a><span class="hl lin"> 1054 </span>            CurrentAction <span class="hl opt">=</span> LASER_ACTION<span class="hl opt">;</span>
<a name="GameplaySM.c_1055"></a><span class="hl lin"> 1055 </span>            <span class="hl slc">// Turn on indicator light</span>
<a name="GameplaySM.c_1056"></a><span class="hl lin"> 1056 </span>            <span class="hl kwd">BatmanLaser</span><span class="hl opt">(</span>LaserON<span class="hl opt">);</span>
<a name="GameplaySM.c_1057"></a><span class="hl lin"> 1057 </span>        <span class="hl opt">}</span>
<a name="GameplaySM.c_1058"></a><span class="hl lin"> 1058 </span>
<a name="GameplaySM.c_1059"></a><span class="hl lin"> 1059 </span>    <span class="hl slc">// Start the Response Timer</span>
<a name="GameplaySM.c_1060"></a><span class="hl lin"> 1060 </span>    <span class="hl kwd">ES_Timer_InitTimer</span><span class="hl opt">(</span>RESPONSE_TIMER<span class="hl opt">,</span> ResponseTime<span class="hl opt">);</span>
<a name="GameplaySM.c_1061"></a><span class="hl lin"> 1061 </span>
<a name="GameplaySM.c_1062"></a><span class="hl lin"> 1062 </span><span class="hl opt">}</span>
<a name="GameplaySM.c_1063"></a><span class="hl lin"> 1063 </span>
<a name="GameplaySM.c_1064"></a><span class="hl lin"> 1064 </span><span class="hl com">/****************************************************************************</span>
<a name="GameplaySM.c_1065"></a><span class="hl lin"> 1065 </span><span class="hl com"> Function</span>
<a name="GameplaySM.c_1066"></a><span class="hl lin"> 1066 </span><span class="hl com">     EvalAction</span>
<a name="GameplaySM.c_1067"></a><span class="hl lin"> 1067 </span><span class="hl com"></span>
<a name="GameplaySM.c_1068"></a><span class="hl lin"> 1068 </span><span class="hl com"> Parameters</span>
<a name="GameplaySM.c_1069"></a><span class="hl lin"> 1069 </span><span class="hl com">     ES_Event</span>
<a name="GameplaySM.c_1070"></a><span class="hl lin"> 1070 </span><span class="hl com"></span>
<a name="GameplaySM.c_1071"></a><span class="hl lin"> 1071 </span><span class="hl com"> Returns</span>
<a name="GameplaySM.c_1072"></a><span class="hl lin"> 1072 </span><span class="hl com">     Nothing</span>
<a name="GameplaySM.c_1073"></a><span class="hl lin"> 1073 </span><span class="hl com"></span>
<a name="GameplaySM.c_1074"></a><span class="hl lin"> 1074 </span><span class="hl com"> Description</span>
<a name="GameplaySM.c_1075"></a><span class="hl lin"> 1075 </span><span class="hl com">     This function evaluates if the response from the user was the correct one.</span>
<a name="GameplaySM.c_1076"></a><span class="hl lin"> 1076 </span><span class="hl com">     If correct, send a motor faster event to MotorSM. If incorrect, motor slower</span>
<a name="GameplaySM.c_1077"></a><span class="hl lin"> 1077 </span><span class="hl com">     event to MotorSM.</span>
<a name="GameplaySM.c_1078"></a><span class="hl lin"> 1078 </span><span class="hl com"></span>
<a name="GameplaySM.c_1079"></a><span class="hl lin"> 1079 </span><span class="hl com"> Notes</span>
<a name="GameplaySM.c_1080"></a><span class="hl lin"> 1080 </span><span class="hl com"></span>
<a name="GameplaySM.c_1081"></a><span class="hl lin"> 1081 </span><span class="hl com"> Author</span>
<a name="GameplaySM.c_1082"></a><span class="hl lin"> 1082 </span><span class="hl com">     B. Jennings 11/20/2012</span>
<a name="GameplaySM.c_1083"></a><span class="hl lin"> 1083 </span><span class="hl com">****************************************************************************/</span>
<a name="GameplaySM.c_1084"></a><span class="hl lin"> 1084 </span><span class="hl kwb">void</span> <span class="hl kwd">EvalAction</span><span class="hl opt">(</span> ES_Event Action <span class="hl opt">)</span>
<a name="GameplaySM.c_1085"></a><span class="hl lin"> 1085 </span><span class="hl opt">{</span>
<a name="GameplaySM.c_1086"></a><span class="hl lin"> 1086 </span>    <span class="hl slc">// Turn off user prompt lights</span>
<a name="GameplaySM.c_1087"></a><span class="hl lin"> 1087 </span>    <span class="hl kwd">BatmanSide</span><span class="hl opt">(</span>OFF<span class="hl opt">);</span>
<a name="GameplaySM.c_1088"></a><span class="hl lin"> 1088 </span>    <span class="hl kwd">BatmanLaser</span><span class="hl opt">(</span>OFF<span class="hl opt">);</span>
<a name="GameplaySM.c_1089"></a><span class="hl lin"> 1089 </span>
<a name="GameplaySM.c_1090"></a><span class="hl lin"> 1090 </span>    <span class="hl kwa">switch</span> <span class="hl opt">(</span>Action<span class="hl opt">.</span>EventType<span class="hl opt">)</span>
<a name="GameplaySM.c_1091"></a><span class="hl lin"> 1091 </span>        <span class="hl opt">{</span>
<a name="GameplaySM.c_1092"></a><span class="hl lin"> 1092 </span>
<a name="GameplaySM.c_1093"></a><span class="hl lin"> 1093 </span>        <span class="hl kwa">case</span> BEAMBREAK <span class="hl opt">:</span>
<a name="GameplaySM.c_1094"></a><span class="hl lin"> 1094 </span>
<a name="GameplaySM.c_1095"></a><span class="hl lin"> 1095 </span>            <span class="hl kwa">if</span> <span class="hl opt">(</span>CurrentAction <span class="hl opt">==</span> LASER_ACTION<span class="hl opt">)</span>
<a name="GameplaySM.c_1096"></a><span class="hl lin"> 1096 </span>                <span class="hl opt">{</span>
<a name="GameplaySM.c_1097"></a><span class="hl lin"> 1097 </span>                    <span class="hl slc">// User Made a Correct Choice</span>
<a name="GameplaySM.c_1098"></a><span class="hl lin"> 1098 </span>                    ES_Event ThisEvent<span class="hl opt">;</span>
<a name="GameplaySM.c_1099"></a><span class="hl lin"> 1099 </span>                    ThisEvent<span class="hl opt">.</span>EventType <span class="hl opt">=</span> MOTORFAST<span class="hl opt">;</span>
<a name="GameplaySM.c_1100"></a><span class="hl lin"> 1100 </span>                    ThisEvent<span class="hl opt">.</span>EventParam <span class="hl opt">=</span> <span class="hl num">0</span><span class="hl opt">;</span>
<a name="GameplaySM.c_1101"></a><span class="hl lin"> 1101 </span>                    <span class="hl kwd">PostMotorSM</span><span class="hl opt">(</span>ThisEvent<span class="hl opt">);</span>
<a name="GameplaySM.c_1102"></a><span class="hl lin"> 1102 </span>                <span class="hl opt">}</span>
<a name="GameplaySM.c_1103"></a><span class="hl lin"> 1103 </span>            <span class="hl kwa">else</span>
<a name="GameplaySM.c_1104"></a><span class="hl lin"> 1104 </span>                <span class="hl opt">{</span>
<a name="GameplaySM.c_1105"></a><span class="hl lin"> 1105 </span>                    <span class="hl slc">// User Made an Incorrect Choice</span>
<a name="GameplaySM.c_1106"></a><span class="hl lin"> 1106 </span>                    ES_Event ThisEvent<span class="hl opt">;</span>
<a name="GameplaySM.c_1107"></a><span class="hl lin"> 1107 </span>                    ThisEvent<span class="hl opt">.</span>EventType <span class="hl opt">=</span> MOTORSLOW<span class="hl opt">;</span>
<a name="GameplaySM.c_1108"></a><span class="hl lin"> 1108 </span>                    ThisEvent<span class="hl opt">.</span>EventParam <span class="hl opt">=</span> <span class="hl num">0</span><span class="hl opt">;</span>
<a name="GameplaySM.c_1109"></a><span class="hl lin"> 1109 </span>                    <span class="hl kwd">PostMotorSM</span><span class="hl opt">(</span>ThisEvent<span class="hl opt">);</span>
<a name="GameplaySM.c_1110"></a><span class="hl lin"> 1110 </span>                <span class="hl opt">}</span>
<a name="GameplaySM.c_1111"></a><span class="hl lin"> 1111 </span>
<a name="GameplaySM.c_1112"></a><span class="hl lin"> 1112 </span>            <span class="hl kwa">break</span><span class="hl opt">;</span>
<a name="GameplaySM.c_1113"></a><span class="hl lin"> 1113 </span>
<a name="GameplaySM.c_1114"></a><span class="hl lin"> 1114 </span>        <span class="hl kwa">case</span> SIDEBUTTON <span class="hl opt">:</span>
<a name="GameplaySM.c_1115"></a><span class="hl lin"> 1115 </span>
<a name="GameplaySM.c_1116"></a><span class="hl lin"> 1116 </span>            <span class="hl kwa">if</span> <span class="hl opt">(</span>CurrentAction <span class="hl opt">==</span> SIDE_BUTTON_ACTION<span class="hl opt">)</span>
<a name="GameplaySM.c_1117"></a><span class="hl lin"> 1117 </span>                <span class="hl opt">{</span>
<a name="GameplaySM.c_1118"></a><span class="hl lin"> 1118 </span>                    <span class="hl slc">// User Made a Correct Choice</span>
<a name="GameplaySM.c_1119"></a><span class="hl lin"> 1119 </span>                    ES_Event ThisEvent<span class="hl opt">;</span>
<a name="GameplaySM.c_1120"></a><span class="hl lin"> 1120 </span>                    ThisEvent<span class="hl opt">.</span>EventType <span class="hl opt">=</span> MOTORFAST<span class="hl opt">;</span>
<a name="GameplaySM.c_1121"></a><span class="hl lin"> 1121 </span>                    ThisEvent<span class="hl opt">.</span>EventParam <span class="hl opt">=</span> <span class="hl num">0</span><span class="hl opt">;</span>
<a name="GameplaySM.c_1122"></a><span class="hl lin"> 1122 </span>                    <span class="hl kwd">PostMotorSM</span><span class="hl opt">(</span>ThisEvent<span class="hl opt">);</span>
<a name="GameplaySM.c_1123"></a><span class="hl lin"> 1123 </span>                <span class="hl opt">}</span>
<a name="GameplaySM.c_1124"></a><span class="hl lin"> 1124 </span>            <span class="hl kwa">else</span>
<a name="GameplaySM.c_1125"></a><span class="hl lin"> 1125 </span>                <span class="hl opt">{</span>
<a name="GameplaySM.c_1126"></a><span class="hl lin"> 1126 </span>                    <span class="hl slc">// User Made an Incorrect Choice</span>
<a name="GameplaySM.c_1127"></a><span class="hl lin"> 1127 </span>                    ES_Event ThisEvent<span class="hl opt">;</span>
<a name="GameplaySM.c_1128"></a><span class="hl lin"> 1128 </span>                    ThisEvent<span class="hl opt">.</span>EventType <span class="hl opt">=</span> MOTORSLOW<span class="hl opt">;</span>
<a name="GameplaySM.c_1129"></a><span class="hl lin"> 1129 </span>                    ThisEvent<span class="hl opt">.</span>EventParam <span class="hl opt">=</span> <span class="hl num">0</span><span class="hl opt">;</span>
<a name="GameplaySM.c_1130"></a><span class="hl lin"> 1130 </span>                    <span class="hl kwd">PostMotorSM</span><span class="hl opt">(</span>ThisEvent<span class="hl opt">);</span>
<a name="GameplaySM.c_1131"></a><span class="hl lin"> 1131 </span>                <span class="hl opt">}</span>
<a name="GameplaySM.c_1132"></a><span class="hl lin"> 1132 </span>
<a name="GameplaySM.c_1133"></a><span class="hl lin"> 1133 </span>            <span class="hl kwa">break</span><span class="hl opt">;</span>
<a name="GameplaySM.c_1134"></a><span class="hl lin"> 1134 </span>
<a name="GameplaySM.c_1135"></a><span class="hl lin"> 1135 </span>        <span class="hl opt">}</span>
<a name="GameplaySM.c_1136"></a><span class="hl lin"> 1136 </span><span class="hl opt">}</span>
<a name="GameplaySM.c_1137"></a><span class="hl lin"> 1137 </span>
<a name="GameplaySM.c_1138"></a><span class="hl lin"> 1138 </span><span class="hl com">/****************************************************************************</span>
<a name="GameplaySM.c_1139"></a><span class="hl lin"> 1139 </span><span class="hl com"> Function</span>
<a name="GameplaySM.c_1140"></a><span class="hl lin"> 1140 </span><span class="hl com">     EvalOilAction</span>
<a name="GameplaySM.c_1141"></a><span class="hl lin"> 1141 </span><span class="hl com"></span>
<a name="GameplaySM.c_1142"></a><span class="hl lin"> 1142 </span><span class="hl com"> Parameters</span>
<a name="GameplaySM.c_1143"></a><span class="hl lin"> 1143 </span><span class="hl com">     ES_Event</span>
<a name="GameplaySM.c_1144"></a><span class="hl lin"> 1144 </span><span class="hl com"></span>
<a name="GameplaySM.c_1145"></a><span class="hl lin"> 1145 </span><span class="hl com"> Returns</span>
<a name="GameplaySM.c_1146"></a><span class="hl lin"> 1146 </span><span class="hl com">     Nothing</span>
<a name="GameplaySM.c_1147"></a><span class="hl lin"> 1147 </span><span class="hl com"></span>
<a name="GameplaySM.c_1148"></a><span class="hl lin"> 1148 </span><span class="hl com"> Description</span>
<a name="GameplaySM.c_1149"></a><span class="hl lin"> 1149 </span><span class="hl com">     This function evaluates a valid or invalid oil slick button press event.</span>
<a name="GameplaySM.c_1150"></a><span class="hl lin"> 1150 </span><span class="hl com">     If the event is valid, it sends the other player into a pause state. If it's</span>
<a name="GameplaySM.c_1151"></a><span class="hl lin"> 1151 </span><span class="hl com">     invalid, it sends the player hwo pushed the button into a pause state.</span>
<a name="GameplaySM.c_1152"></a><span class="hl lin"> 1152 </span><span class="hl com"></span>
<a name="GameplaySM.c_1153"></a><span class="hl lin"> 1153 </span><span class="hl com"> Notes</span>
<a name="GameplaySM.c_1154"></a><span class="hl lin"> 1154 </span><span class="hl com"></span>
<a name="GameplaySM.c_1155"></a><span class="hl lin"> 1155 </span><span class="hl com"> Author</span>
<a name="GameplaySM.c_1156"></a><span class="hl lin"> 1156 </span><span class="hl com">     B. Jennings 11/20/2012</span>
<a name="GameplaySM.c_1157"></a><span class="hl lin"> 1157 </span><span class="hl com">****************************************************************************/</span>
<a name="GameplaySM.c_1158"></a><span class="hl lin"> 1158 </span><span class="hl kwb">void</span> <span class="hl kwd">EvalOilAction</span><span class="hl opt">(</span> ES_Event OilAction<span class="hl opt">)</span>
<a name="GameplaySM.c_1159"></a><span class="hl lin"> 1159 </span><span class="hl opt">{</span>
<a name="GameplaySM.c_1160"></a><span class="hl lin"> 1160 </span>    <span class="hl kwa">if</span> <span class="hl opt">(</span>OilAction<span class="hl opt">.</span>EventParam <span class="hl opt">==</span> FROMJOKER<span class="hl opt">)</span>
<a name="GameplaySM.c_1161"></a><span class="hl lin"> 1161 </span>        <span class="hl opt">{</span>
<a name="GameplaySM.c_1162"></a><span class="hl lin"> 1162 </span>            <span class="hl slc">// Generate Event and send to MotorSM</span>
<a name="GameplaySM.c_1163"></a><span class="hl lin"> 1163 </span>            ES_Event ThisEvent<span class="hl opt">;</span>
<a name="GameplaySM.c_1164"></a><span class="hl lin"> 1164 </span>            ThisEvent<span class="hl opt">.</span>EventType <span class="hl opt">=</span> MOTORSTOP<span class="hl opt">;</span>
<a name="GameplaySM.c_1165"></a><span class="hl lin"> 1165 </span>            ThisEvent<span class="hl opt">.</span>EventParam <span class="hl opt">=</span> <span class="hl num">0</span><span class="hl opt">;</span>
<a name="GameplaySM.c_1166"></a><span class="hl lin"> 1166 </span>            <span class="hl kwd">PostMotorSM</span><span class="hl opt">(</span>ThisEvent<span class="hl opt">);</span>
<a name="GameplaySM.c_1167"></a><span class="hl lin"> 1167 </span>
<a name="GameplaySM.c_1168"></a><span class="hl lin"> 1168 </span>            <span class="hl slc">// Set CurrentState to OilPause</span>
<a name="GameplaySM.c_1169"></a><span class="hl lin"> 1169 </span>            CurrentState <span class="hl opt">=</span> OilPause<span class="hl opt">;</span>
<a name="GameplaySM.c_1170"></a><span class="hl lin"> 1170 </span>
<a name="GameplaySM.c_1171"></a><span class="hl lin"> 1171 </span>            <span class="hl slc">// Set Timer to Response Time and Pause</span>
<a name="GameplaySM.c_1172"></a><span class="hl lin"> 1172 </span>            <span class="hl kwd">ES_Timer_InitTimer</span><span class="hl opt">(</span>RESPONSE_TIMER<span class="hl opt">,</span> ResponseTime<span class="hl opt">);</span>
<a name="GameplaySM.c_1173"></a><span class="hl lin"> 1173 </span>        <span class="hl opt">}</span>
<a name="GameplaySM.c_1174"></a><span class="hl lin"> 1174 </span>
<a name="GameplaySM.c_1175"></a><span class="hl lin"> 1175 </span>    <span class="hl kwa">if</span> <span class="hl opt">(</span>OilPrompt <span class="hl opt">==</span> ON<span class="hl opt">)</span> <span class="hl slc">// OilSlick Button pressed correctly</span>
<a name="GameplaySM.c_1176"></a><span class="hl lin"> 1176 </span>        <span class="hl opt">{</span>
<a name="GameplaySM.c_1177"></a><span class="hl lin"> 1177 </span>            <span class="hl slc">// Send valid oilslick event to Joker</span>
<a name="GameplaySM.c_1178"></a><span class="hl lin"> 1178 </span>            ES_Event ThisEvent<span class="hl opt">;</span>
<a name="GameplaySM.c_1179"></a><span class="hl lin"> 1179 </span>            ThisEvent<span class="hl opt">.</span>EventType <span class="hl opt">=</span> SENDREQ<span class="hl opt">;</span>
<a name="GameplaySM.c_1180"></a><span class="hl lin"> 1180 </span>            ThisEvent<span class="hl opt">.</span>EventParam <span class="hl opt">=</span> OilSlick<span class="hl opt">;</span>
<a name="GameplaySM.c_1181"></a><span class="hl lin"> 1181 </span>            <span class="hl kwd">PostComSM</span><span class="hl opt">(</span>ThisEvent<span class="hl opt">);</span>
<a name="GameplaySM.c_1182"></a><span class="hl lin"> 1182 </span>
<a name="GameplaySM.c_1183"></a><span class="hl lin"> 1183 </span>            <span class="hl slc">// Turn off the Oil Button Prompt</span>
<a name="GameplaySM.c_1184"></a><span class="hl lin"> 1184 </span>            <span class="hl kwd">BatmanOil</span><span class="hl opt">(</span>OFF<span class="hl opt">);</span>
<a name="GameplaySM.c_1185"></a><span class="hl lin"> 1185 </span>
<a name="GameplaySM.c_1186"></a><span class="hl lin"> 1186 </span>            <span class="hl slc">// Capture state of Oil Button Prompt</span>
<a name="GameplaySM.c_1187"></a><span class="hl lin"> 1187 </span>            OilPrompt <span class="hl opt">=</span> OFF<span class="hl opt">;</span>
<a name="GameplaySM.c_1188"></a><span class="hl lin"> 1188 </span>        <span class="hl opt">}</span>
<a name="GameplaySM.c_1189"></a><span class="hl lin"> 1189 </span>
<a name="GameplaySM.c_1190"></a><span class="hl lin"> 1190 </span>    <span class="hl kwa">else</span> <span class="hl slc">// OilSlick Button pressed incorrectly</span>
<a name="GameplaySM.c_1191"></a><span class="hl lin"> 1191 </span>        <span class="hl opt">{</span>
<a name="GameplaySM.c_1192"></a><span class="hl lin"> 1192 </span>            <span class="hl slc">// Generate and post event</span>
<a name="GameplaySM.c_1193"></a><span class="hl lin"> 1193 </span>            ES_Event ThisEvent<span class="hl opt">;</span>
<a name="GameplaySM.c_1194"></a><span class="hl lin"> 1194 </span>            ThisEvent<span class="hl opt">.</span>EventType <span class="hl opt">=</span> MOTORSTOP<span class="hl opt">;</span>
<a name="GameplaySM.c_1195"></a><span class="hl lin"> 1195 </span>            ThisEvent<span class="hl opt">.</span>EventParam <span class="hl opt">=</span> <span class="hl num">0</span><span class="hl opt">;</span>
<a name="GameplaySM.c_1196"></a><span class="hl lin"> 1196 </span>            <span class="hl kwd">PostMotorSM</span><span class="hl opt">(</span>ThisEvent<span class="hl opt">);</span>
<a name="GameplaySM.c_1197"></a><span class="hl lin"> 1197 </span>
<a name="GameplaySM.c_1198"></a><span class="hl lin"> 1198 </span>            <span class="hl slc">// Set Current State to pause and wait for timeout</span>
<a name="GameplaySM.c_1199"></a><span class="hl lin"> 1199 </span>            CurrentState <span class="hl opt">=</span> OilPause<span class="hl opt">;</span>
<a name="GameplaySM.c_1200"></a><span class="hl lin"> 1200 </span>
<a name="GameplaySM.c_1201"></a><span class="hl lin"> 1201 </span>            <span class="hl slc">// Set Timer to Response Time and Pause</span>
<a name="GameplaySM.c_1202"></a><span class="hl lin"> 1202 </span>            <span class="hl kwd">ES_Timer_InitTimer</span><span class="hl opt">(</span>RESPONSE_TIMER<span class="hl opt">,</span> ResponseTime<span class="hl opt">);</span>
<a name="GameplaySM.c_1203"></a><span class="hl lin"> 1203 </span>        <span class="hl opt">}</span>
<a name="GameplaySM.c_1204"></a><span class="hl lin"> 1204 </span><span class="hl opt">}</span>
<a name="GameplaySM.c_1205"></a><span class="hl lin"> 1205 </span>
<a name="GameplaySM.c_1206"></a><span class="hl lin"> 1206 </span><span class="hl com">/****************************************************************************</span>
<a name="GameplaySM.c_1207"></a><span class="hl lin"> 1207 </span><span class="hl com"> Function</span>
<a name="GameplaySM.c_1208"></a><span class="hl lin"> 1208 </span><span class="hl com">     EvalGameEnd</span>
<a name="GameplaySM.c_1209"></a><span class="hl lin"> 1209 </span><span class="hl com"></span>
<a name="GameplaySM.c_1210"></a><span class="hl lin"> 1210 </span><span class="hl com"> Parameters</span>
<a name="GameplaySM.c_1211"></a><span class="hl lin"> 1211 </span><span class="hl com">     Nothing</span>
<a name="GameplaySM.c_1212"></a><span class="hl lin"> 1212 </span><span class="hl com"></span>
<a name="GameplaySM.c_1213"></a><span class="hl lin"> 1213 </span><span class="hl com"> Returns</span>
<a name="GameplaySM.c_1214"></a><span class="hl lin"> 1214 </span><span class="hl com">     Nothing</span>
<a name="GameplaySM.c_1215"></a><span class="hl lin"> 1215 </span><span class="hl com"></span>
<a name="GameplaySM.c_1216"></a><span class="hl lin"> 1216 </span><span class="hl com"> Description</span>
<a name="GameplaySM.c_1217"></a><span class="hl lin"> 1217 </span><span class="hl com">     This function evaluates who wins</span>
<a name="GameplaySM.c_1218"></a><span class="hl lin"> 1218 </span><span class="hl com"></span>
<a name="GameplaySM.c_1219"></a><span class="hl lin"> 1219 </span><span class="hl com"> Notes</span>
<a name="GameplaySM.c_1220"></a><span class="hl lin"> 1220 </span><span class="hl com"></span>
<a name="GameplaySM.c_1221"></a><span class="hl lin"> 1221 </span><span class="hl com"> Author</span>
<a name="GameplaySM.c_1222"></a><span class="hl lin"> 1222 </span><span class="hl com">     B. Jennings 11/20/2012</span>
<a name="GameplaySM.c_1223"></a><span class="hl lin"> 1223 </span><span class="hl com">****************************************************************************/</span>
<a name="GameplaySM.c_1224"></a><span class="hl lin"> 1224 </span><span class="hl kwb">void</span> <span class="hl kwd">EvalGameEnd</span><span class="hl opt">(</span> <span class="hl kwb">void</span> <span class="hl opt">)</span>
<a name="GameplaySM.c_1225"></a><span class="hl lin"> 1225 </span><span class="hl opt">{</span>
<a name="GameplaySM.c_1226"></a><span class="hl lin"> 1226 </span>    <span class="hl slc">//Start Celebration Timer</span>
<a name="GameplaySM.c_1227"></a><span class="hl lin"> 1227 </span>    <span class="hl kwd">ES_Timer_InitTimer</span><span class="hl opt">(</span>RESPONSE_TIMER<span class="hl opt">,</span> CELEBRATION_TIME<span class="hl opt">);</span>
<a name="GameplaySM.c_1228"></a><span class="hl lin"> 1228 </span>
<a name="GameplaySM.c_1229"></a><span class="hl lin"> 1229 </span>    <span class="hl kwa">if</span> <span class="hl opt">(</span><span class="hl kwd">QueryGameplaySM</span><span class="hl opt">() !=</span> Wait4Bomb<span class="hl opt">)</span> <span class="hl slc">// Batman Loses</span>
<a name="GameplaySM.c_1230"></a><span class="hl lin"> 1230 </span>        <span class="hl opt">{</span>
<a name="GameplaySM.c_1231"></a><span class="hl lin"> 1231 </span>            <span class="hl slc">// GameOver functions called here (Lighting, audio, etc...)</span>
<a name="GameplaySM.c_1232"></a><span class="hl lin"> 1232 </span>            ES_Event ThisEvent<span class="hl opt">;</span>
<a name="GameplaySM.c_1233"></a><span class="hl lin"> 1233 </span>            ThisEvent<span class="hl opt">.</span>EventType <span class="hl opt">=</span> SENDREQ<span class="hl opt">;</span>
<a name="GameplaySM.c_1234"></a><span class="hl lin"> 1234 </span>            ThisEvent<span class="hl opt">.</span>EventParam <span class="hl opt">=</span> BatmanLose<span class="hl opt">;</span>
<a name="GameplaySM.c_1235"></a><span class="hl lin"> 1235 </span>            <span class="hl kwd">PostComSM</span><span class="hl opt">(</span>ThisEvent<span class="hl opt">);</span>
<a name="GameplaySM.c_1236"></a><span class="hl lin"> 1236 </span>
<a name="GameplaySM.c_1237"></a><span class="hl lin"> 1237 </span>            <span class="hl slc">// Ensure BATMANWIN_LIGHTS Off</span>
<a name="GameplaySM.c_1238"></a><span class="hl lin"> 1238 </span>            BWIN_LIGHTS <span class="hl opt">=</span> OFF<span class="hl opt">;</span>
<a name="GameplaySM.c_1239"></a><span class="hl lin"> 1239 </span>        <span class="hl opt">}</span>
<a name="GameplaySM.c_1240"></a><span class="hl lin"> 1240 </span>
<a name="GameplaySM.c_1241"></a><span class="hl lin"> 1241 </span>    <span class="hl kwa">else</span> <span class="hl slc">//Batman Wins</span>
<a name="GameplaySM.c_1242"></a><span class="hl lin"> 1242 </span>        <span class="hl opt">{</span>
<a name="GameplaySM.c_1243"></a><span class="hl lin"> 1243 </span>            <span class="hl slc">// GameOver functions called here (Lighting, audio, etc...)</span>
<a name="GameplaySM.c_1244"></a><span class="hl lin"> 1244 </span>            ES_Event ThisEvent<span class="hl opt">;</span>
<a name="GameplaySM.c_1245"></a><span class="hl lin"> 1245 </span>            ThisEvent<span class="hl opt">.</span>EventType <span class="hl opt">=</span> SENDREQ<span class="hl opt">;</span>
<a name="GameplaySM.c_1246"></a><span class="hl lin"> 1246 </span>            ThisEvent<span class="hl opt">.</span>EventParam <span class="hl opt">=</span> BatmanWin<span class="hl opt">;</span>
<a name="GameplaySM.c_1247"></a><span class="hl lin"> 1247 </span>            <span class="hl kwd">PostComSM</span><span class="hl opt">(</span>ThisEvent<span class="hl opt">);</span>
<a name="GameplaySM.c_1248"></a><span class="hl lin"> 1248 </span>
<a name="GameplaySM.c_1249"></a><span class="hl lin"> 1249 </span>            <span class="hl slc">// Turn on BATMANWIN_LIGHTS</span>
<a name="GameplaySM.c_1250"></a><span class="hl lin"> 1250 </span>            BWIN_LIGHTS <span class="hl opt">=</span> <span class="hl num">1</span><span class="hl opt">;</span>
<a name="GameplaySM.c_1251"></a><span class="hl lin"> 1251 </span>        <span class="hl opt">}</span>
<a name="GameplaySM.c_1252"></a><span class="hl lin"> 1252 </span><span class="hl opt">}</span>
<a name="GameplaySM.c_1253"></a><span class="hl lin"> 1253 </span>
<a name="GameplaySM.c_1254"></a><span class="hl lin"> 1254 </span>
<a name="GameplaySM.c_1255"></a><span class="hl lin"> 1255 </span><span class="hl com">/****************************************************************************</span>
<a name="GameplaySM.c_1256"></a><span class="hl lin"> 1256 </span><span class="hl com"> Function</span>
<a name="GameplaySM.c_1257"></a><span class="hl lin"> 1257 </span><span class="hl com">     ChangeResponseTime</span>
<a name="GameplaySM.c_1258"></a><span class="hl lin"> 1258 </span><span class="hl com"></span>
<a name="GameplaySM.c_1259"></a><span class="hl lin"> 1259 </span><span class="hl com"> Parameters</span>
<a name="GameplaySM.c_1260"></a><span class="hl lin"> 1260 </span><span class="hl com">     char</span>
<a name="GameplaySM.c_1261"></a><span class="hl lin"> 1261 </span><span class="hl com"></span>
<a name="GameplaySM.c_1262"></a><span class="hl lin"> 1262 </span><span class="hl com"> Returns</span>
<a name="GameplaySM.c_1263"></a><span class="hl lin"> 1263 </span><span class="hl com">     Nothing</span>
<a name="GameplaySM.c_1264"></a><span class="hl lin"> 1264 </span><span class="hl com"></span>
<a name="GameplaySM.c_1265"></a><span class="hl lin"> 1265 </span><span class="hl com"> Description</span>
<a name="GameplaySM.c_1266"></a><span class="hl lin"> 1266 </span><span class="hl com">     This function changes the ResponseTime value so that the timer initializes</span>
<a name="GameplaySM.c_1267"></a><span class="hl lin"> 1267 </span><span class="hl com">     correctly.</span>
<a name="GameplaySM.c_1268"></a><span class="hl lin"> 1268 </span><span class="hl com"></span>
<a name="GameplaySM.c_1269"></a><span class="hl lin"> 1269 </span><span class="hl com"> Notes</span>
<a name="GameplaySM.c_1270"></a><span class="hl lin"> 1270 </span><span class="hl com"></span>
<a name="GameplaySM.c_1271"></a><span class="hl lin"> 1271 </span><span class="hl com"> Author</span>
<a name="GameplaySM.c_1272"></a><span class="hl lin"> 1272 </span><span class="hl com">     B. Jennings 11/20/2012</span>
<a name="GameplaySM.c_1273"></a><span class="hl lin"> 1273 </span><span class="hl com">****************************************************************************/</span>
<a name="GameplaySM.c_1274"></a><span class="hl lin"> 1274 </span><span class="hl kwb">void</span> <span class="hl kwd">ChangeResponseTime</span><span class="hl opt">(</span> <span class="hl kwb">int</span> NextTimeVal <span class="hl opt">)</span>
<a name="GameplaySM.c_1275"></a><span class="hl lin"> 1275 </span><span class="hl opt">{</span>
<a name="GameplaySM.c_1276"></a><span class="hl lin"> 1276 </span>    ResponseTime <span class="hl opt">=</span> NextTimeVal<span class="hl opt">;</span>
<a name="GameplaySM.c_1277"></a><span class="hl lin"> 1277 </span><span class="hl opt">}</span>
<a name="GameplaySM.c_1278"></a><span class="hl lin"> 1278 </span>
<a name="GameplaySM.c_1279"></a><span class="hl lin"> 1279 </span><span class="hl com">/****************************************************************************</span>
<a name="GameplaySM.c_1280"></a><span class="hl lin"> 1280 </span><span class="hl com"> Function</span>
<a name="GameplaySM.c_1281"></a><span class="hl lin"> 1281 </span><span class="hl com">     NextAction</span>
<a name="GameplaySM.c_1282"></a><span class="hl lin"> 1282 </span><span class="hl com"></span>
<a name="GameplaySM.c_1283"></a><span class="hl lin"> 1283 </span><span class="hl com"> Parameters</span>
<a name="GameplaySM.c_1284"></a><span class="hl lin"> 1284 </span><span class="hl com">     None</span>
<a name="GameplaySM.c_1285"></a><span class="hl lin"> 1285 </span><span class="hl com"></span>
<a name="GameplaySM.c_1286"></a><span class="hl lin"> 1286 </span><span class="hl com"> Returns</span>
<a name="GameplaySM.c_1287"></a><span class="hl lin"> 1287 </span><span class="hl com">     Nothing</span>
<a name="GameplaySM.c_1288"></a><span class="hl lin"> 1288 </span><span class="hl com"></span>
<a name="GameplaySM.c_1289"></a><span class="hl lin"> 1289 </span><span class="hl com"> Description</span>
<a name="GameplaySM.c_1290"></a><span class="hl lin"> 1290 </span><span class="hl com">     This function changes the event that should be prompted to the user.</span>
<a name="GameplaySM.c_1291"></a><span class="hl lin"> 1291 </span><span class="hl com"></span>
<a name="GameplaySM.c_1292"></a><span class="hl lin"> 1292 </span><span class="hl com"> Notes</span>
<a name="GameplaySM.c_1293"></a><span class="hl lin"> 1293 </span><span class="hl com"></span>
<a name="GameplaySM.c_1294"></a><span class="hl lin"> 1294 </span><span class="hl com"> Author</span>
<a name="GameplaySM.c_1295"></a><span class="hl lin"> 1295 </span><span class="hl com">     B. Jennings 12/01/2012</span>
<a name="GameplaySM.c_1296"></a><span class="hl lin"> 1296 </span><span class="hl com">****************************************************************************/</span>
<a name="GameplaySM.c_1297"></a><span class="hl lin"> 1297 </span><span class="hl kwb">void</span> <span class="hl kwd">ChangeAction</span><span class="hl opt">(</span> <span class="hl kwb">void</span> <span class="hl opt">)</span>
<a name="GameplaySM.c_1298"></a><span class="hl lin"> 1298 </span><span class="hl opt">{</span>
<a name="GameplaySM.c_1299"></a><span class="hl lin"> 1299 </span>    <span class="hl slc">// Change Action</span>
<a name="GameplaySM.c_1300"></a><span class="hl lin"> 1300 </span>    NextAction ^<span class="hl opt">=</span> LASER_ACTION<span class="hl opt">;</span>
<a name="GameplaySM.c_1301"></a><span class="hl lin"> 1301 </span><span class="hl opt">}</span>
</pre>
</body>
</html>
<!--HTML generated by highlight 3.5, http://www.andre-simon.de/-->
